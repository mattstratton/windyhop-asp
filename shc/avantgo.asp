<%Option ExplicitResponse.Buffer = FALSEDim sMenu'sMenu = "<table width=""100%"">"Dim sMenuLineDim zCONST MENUCOLS = 3z = 1%><!-- #include file="../include/globalc.inc" --><!-- <STYLE TYPE="text/css"><!--BODY  {	font-family : Verdana, Helvetica,sans-serif;	font-size : x-small;	margin-left : 0 px;	margin-top : 0 px;}</STYLE>--><!-- #include file="../include/getonefield.inc" --><!-- #include file="../include/getname.inc" --><!-- #include file="../include/geteventset.inc" --><%' GetEventSet( 	lngBandID,'				lngVenueID,'				lngInstructorID,'				strLesson, '				strShowDJ,'				strOther, '				strWorkshop,'				datBeginDate, '				datEndDate,'				strApproved,' 				lngEventID)'Get me to Sunday!CONST CURRENT_PAGE = "zoot.asp"Dim datStartDateDim datFinishDateDim strBodyDim strHeaderDim strFooterDim strSubjectDim strCustomMessageDim objDBDim objRSDim strSQLDim strSubscriberSQLDim LastEventDayDim CurrentEventDay''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function FormatEvent(strDate, strEventName, strBandName, strVenueName, strVenueAddress1, strVenueCity, strVenueState, strLessonTime,strShowTime, strEndTime, strAge, strPrice, strEventNote1, strEventNote2)	Dim strTemp	'strTemp = strTemp &  Month(strDate)&"/"&Day(strDate)&" - "	strTemp = strTemp &  Ucase(strEventName&" @ "&strVenueName)& "<br>"	If strEventName <> strBandName Then		strTemp = strTemp & "Featuring " & strBandName & "<br>"	End If	strTemp = strTemp & strVenueAddress1 & " - " & strVenueCity & ", " & strVenueState & "<br>"	If strLessonTime <> "" Then		strTemp = strTemp & "Lesson " & strLessonTime & ", "	End If		strTemp = strTemp &  "Show " & strShowTime	If strEndTime <> "" Then		strTemp = strTemp & " - " & strEndTime	End IF 	strTemp = strTemp & "<br>"	If strAge <> "" Then		strTemp = strTemp & strAge & " - "	End If		strTemp = strTemp & strPrice & "<br>"	If strEventNote1 <> "" Then		strTemp = strTemp &  ChopToWidth(strEventNote1,ZOOT_WIDTH) & "<br>"		'strTemp = strTemp & strEventNote1 & "<br>"	End If		If strEventNote2 <> "" Then		strTemp = strTemp &  ChopToWidth(strEventNote2, ZOOT_WIDTH) & "<br>"	End If	strTemp = strTemp &  "<br>"		FormatEvent = strTempEnd Function 'FormatEvent()''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function BuildBody(lngBandID,lngVenueID,lngInstructorID,strLesson, strShowDJ, strOther, strWorkshop,datBeginDate, datEndDate)	Dim strFormattedEvent	'Response.Write("<br>ShowDJ = " & strShowDJ & "<br>")	GetEventSet lngBandID,lngVenueID,lngInstructorID,strLesson, strShowDJ, strOther, strWorkshop,datBeginDate, datEndDate, "", ""	'GetEventSet "","","", "", YES, "", "", datSrtDate, datEndDate,"",""		LastEventDay = 0	CurrentEventDay = Weekday(objRSEvent("Date"))			While Not objRSEvent.EOF 		CurrentEventDay = Weekday(objRSEvent("Date"))		If LastEventDay <> CurrentEventDay Then						sMenuLine = "<center><a href=""#" & Month(objRSEvent("Date")) & Day(objRSEvent("Date"))& """>" & WeekdayName(Weekday(objRSEvent("Date")),TRUE)&", "&MonthName(Month(objRSEvent("Date")))&" "&Day(objRSEvent("Date"))& "</a></center>"				'Select Case z				'	Case 1				'		sMenu = sMenu & "<tr><td>" & sMenuLine & "</td>"				'		z = z + 1				'	Case MENUCOLS				'		sMenu = sMenu & "<td>" & sMenuLine & "</td></tr>"				'		z = 1				'	Case Else				'		sMenu = sMenu & "<td>" & sMenuLine & "</td>"				'		z = z + 1				'End Select					sMenu = sMenu & sMenuLine						BuildBody = BuildBody & "<table width=""100%""><tr><td align=left><b><a name=""" & Month(objRSEvent("Date")) & Day(objRSEvent("Date")) & """>" & WeekdayName(Weekday(objRSEvent("Date")))&", "&MonthName(Month(objRSEvent("Date")))&" "&Day(objRSEvent("Date"))&", "&Year(objRSEvent("Date"))& "</td><td align=right></b> <a href=#top>home</a></td></tr></table><br>"			'BuildBody = BuildBody & "------------------------------------"&"<br>"		End If		strFormattedEvent = FormatEvent(objRSEvent("Date"), _									    objRSEvent("EventName"), _ 										objRSEvent("BandName"), _										objRSEvent("VenueName"), _										objRSEvent("VenueAddress1"), _ 										objRSEvent("VenueCity"), _										objRSEvent("VenueState"), _										objRSEvent("LessonTime"), _										objRSEvent("ShowTime"), _										objRSEvent("EndTime"), _										objRSEvent("Age"), _										objRSEvent("Price"), _										objRSEvent("EventNote1"), _ 										objRSEvent("EventNote2") _									   )		BuildBody = BuildBody & strFormattedEvent		LastEventDay = Weekday(objRSEvent("Date"))		objRSEvent.MoveNext	Wend	'sMenu = sMenu & "</table>"End Function 'BuildBody''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function BuildFooter()	Dim strTemp	Dim fso	Dim fZootBottom	Set fso = CreateObject("Scripting.FileSystemObject")	'Response.Write(Server.MapPath(".") & "\include\zootbottom.inc")	Set fZootBottom = fso.OpenTextFile(Server.Mappath(".") & "\..\include\zootbottom.txt")	BuildFooter = strHorLine & "<br>" & ChopToWidth(fZootBottom.ReadAll,ZOOT_WIDTH)	Set fso = Nothing	Set fZootBottom = Nothing	End Function''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function CenterText(strString, strWrap)	Dim iNumOfSpaces	Dim iNumLeft, iNumRight	Dim bolWrapped		if StrWrap <> "" Then bolWrapped = TRUE		If bolWrapped Then		iNumOfSpaces = (ZOOT_WIDTH-2) - Len(strString)	Else		iNumOfSpaces = (ZOOT_WIDTH) - Len(strString)	End If		iNumLeft = CInt(iNumOfSpaces/2)	' If it's odd, cut the odd space off the right	If iNumLeft*2 < iNumOfSpaces Then		iNumRight = CInt(iNumOfSpaces/2) + 1 		ElseIf  iNumLeft*2 > iNumOfSpaces Then		iNumRight = CInt(iNumOfSpaces/2) - 1	Else 		iNumRight = CInt(iNumOfSpaces/2) 	End If		'CenterText = iNumOfSpaces & "," & iNumLeft & "," & iNumRight & "," & "|" & String(iNumLeft, " ") & strString & String(iNumRight, " ") & "|"	If bolWrapped Then		CenterText = strWrap & String(iNumLeft, " ") & strString & String(iNumRight, " ") & strWrap	Else		CenterText = String(iNumLeft, " ") & strString & String(iNumRight, " ") 	End If	End Function''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function BuildHeader(datSrtDate, datEndDate)	Dim iLen	'Dim strLine	Dim strEventsIncluded		BuildHeader = strHorLine	iLen = Len(BuildHeader)	BuildHeader = BuildHeader  & "<a name=""top""><center><b>Windyhop</b><br>" 	'BuildHeader = BuildHeader  & "<a name=""top""><center><img src=""./images/shc.gif""><br>" 	BuildHeader = BuildHeader  & "Chicago's Online Swing Community<br>"	' This logic is for padding the end of the text box with enough spaces.  Since the dates	'    are variable lengths, you can't hard code it.  -jdw 1/29/00	BuildHeader = BuildHeader & "ALL SWING GIGS FOR<br> "&datSrtDate&" - "&datEndDate & "<br>"		BuildHeader = BuildHeader & "This info is as of " & Date & "<br></center>"	'strLine = strLine & String(iLen-Len(strLine)-1, " ")	'BuildHeader = BuildHeader & strLine & "|"&"<br>"	'strLine = ""	'BuildHeader = BuildHeader & CenterText("Please visit www.windyhop.org", "|") & "<br>"	'BuildHeader = BuildHeader & CenterText("for current information.", "|") & "<br>"	'BuildHeader = BuildHeader & strHorLine & "<br>"	End Function 'BuildHeader()''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' ChopToWidth(strText, iWidth) - Takes the text string passed to it, and adds a newline character after' 	the appropriate width.  Will figure out word breaks.' INPUT - strText: text string to add newline characters to.' 		  iWidth: width of lines to chop to.' OUTPUT: same text string, but with newline characters''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function ChopToWidth(strText, iWidth)	'ChopToWidth = strText	'Exit Function	Dim strTemp	Dim iCurrentChar	Dim iTemp	Dim strReturn	Dim x 	'iWidth=20	iCurrentChar = 1	Dim iCount	Dim bNewLineInString			While iCurrentChar <= Len(strText)			'Saves from infinite loop!		x = x + 1		if x > 100 Then 			ChopToWidth = strReturn			Exit Function		End If				' 32 = newline		' 46 = .		' 13 = space		While  Asc(Mid(strText,iCurrentChar,1)) = 32 _ 			OR Asc(Mid(strText,iCurrentChar,1)) = 46 _ 			OR Asc(Mid(strText,iCurrentChar,1)) = 13  			iCurrentChar = iCurrentChar + 1		Wend			strTemp = Mid(strText, iCurrentChar, iWidth)		'If there is a newline in the current line		iTemp = InStr(strTemp, vbcrlf)		If iTemp <> 0 Then			strTemp = Mid(strText,iCurrentChar,iTemp)		'If the last character is NOT a SPACE		ElseIf Len(strTemp) < iWidth Then ' AND bNewLineInString = FALSE Then 'It's the last line in the block						strTemp = strTemp 			iCurrentChar = 1000000000		ElseIf Right(strTemp,1) <> " " Then ' AND (Len(strTemp) = iWidth) Then			iTemp = InStrRev(strTemp," ")			If iTemp = 0 Then 'no spaces 1 word is the whole line				strTemp = strTemp & vbCrlF			Else				strTemp = Mid(strText,iCurrentChar, iTemp) & vbCrlF			End If		Else			strTemp = strTemp & vbCrlF		End If				strReturn = strReturn & strTemp						iCurrentChar = iCurrentChar + Len(Replace(strTemp,vbCrlF,""))	Wend	ChopToWidth = strReturn	End Function''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function BuildCustomMessage(strCustomMessage)	If strCustomMessage <> "" Then		BuildCustomMessage = ChopToWidth(strCustomMessage,ZOOT_WIDTH) & "<br>" & strHorLine & "<br>"	Else		BuildCustomMessage = ""	End IfEnd Function''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function BuildSubject(datSrtDate, datEndDate)	BuildSubject = "Chicago Swing Events for "&Month(datSrtDate)&"/"&Day(datSrtDate)&"-"&Month(datEndDate)&"/"&Day(datEndDate)End Function''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function FormatDate(datDate)	FormatDate = "<b>" & WeekdayName(Weekday(datDate),TRUE) & ", " & MonthName(Month(datDate),TRUE)& " " & Day(datDate)&", "&Year(datDate) & "</b>"End Function''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub FormatMessage()	'Dim strInThisIssue	'strInThisIssue = "In This Issue:" & "<br>"	'If Request.Form("showdj") = YES Then	'	strInThisIssue = strInThisIssue & "- Show/DJ Events" & "<br>"	'End If	'If Request.Form("workshop") = YES Then	'	strInThisIssue = strInThisIssue & "- Workshops" & "<br>"	'End If	'strInThisIssue = strInThisIssue & strHorLine & "<br>"	strBody = BuildBody("","","", "", YES, "", "", datStartDate,datEndDate)			strSubject = BuildSubject(Request.Form("startdate"),Request.Form("enddate"))	strHeader = BuildHeader(datStartDate, datEndDate)	strCustomMessage = BuildCustomMessage(Request.Form("custommessage"))	strFooter = BuildFooter()		'strBody = StripHTMLTag(strBody)		strBody = strHeader & sMenu & strCustomMessage & "<br>" &  strBody '& strFooter		Session("startdate") = Request.Form("startdate")	Session("enddate") = Request.Form("enddate")	Session("strBody") = strBody	Session("strSubject") = strSubject		%>	<title>Windyhop Events</title>	<table width=160 rules=all><tr><td>	<%	Response.Write(strBody)	%>	</td></tr></table>	<%End Sub 'FormatMessage()''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function Main()	Dim sAction	Dim strSQL		datStartDate = Date	While Weekday(datStartDate) <> vbMonday		datStartDate = DateAdd("d",-1,datStartDate)	Wend		datEndDate = DateAdd("d", 13, datStartDate)			FormatMessage()	Main = TRUEEnd Function''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Dim bolErrorDim strHorLine'strHorLine = "+" & String(ZOOT_WIDTH-2, "=") & "+" ' ZOOT_WIDTH is the width of the email messageCONST ZOOT_WIDTH = 60	bolError = Main()%>