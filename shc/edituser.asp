<%Option ExplicitResponse.Buffer = TRUE'On Error Resume NextConst CURRENT_PAGE = "edituser.asp"If Session("userid") = "" and Request.Form("userid") > 0 Then	Response.Redirect("edit.asp")End If%><!-- #include file="../include/newtop.txt" --><!-- #include file="../include/libformobjects.inc" --><!-- #include file="../include/phone_format.inc" --><!-- #include file="../include/getonefield.inc" --><!-- #include file="../include/writetablerow.inc" --><!-- #include file="../include/getname.inc" --><!-- #include file="../include/requiredlegend.inc" --><!-- #include file="../include/fielddesc.inc" --><!-- #include file="../include/sendmail.inc" --><!-- #include file="../include/stripHTMLtag.inc" --><!-- #include file="../include/hasrights.inc" --><!-- #include file="../include/notifyadmin.inc" --><%'''''''''''Sub ReadUBBFile(ubbID)	'	Field 1: UserName<BR>	'	Field 2: Password<BR'>'	Field 3: Email address<BR>'	Field 4: URL<BR>'	Field 5: Permissions (Any or none of Write (gives permission to post) and Admin (admin privileges), possibly followed by an &amp; and a list of private forums user is allowed to access (&amp; separated)).<BR>'	Field 6: Occupation<BR>'	Field 7: Location<BR>'	Field 8: Total Posts<BR>'	Field 9: Status (Administrator, Moderator, etc..)<BR>'	Field 10: Interests<BR>'	Field 11: Date Registered<BR>'	Field 12: Allow email address to be viewed? Valid values are "yes" and "no".<BR>'	Field 13: Signature<BR>'	Field 14: ICQ number<BR>'	Field 15: Allow BB operators to email in mass mailing? Valid values are "yes" and "no".'   Field 16: YahooID	Dim bolFileExists	serverpath=server.mappath(".") & "\..\..\data\Members\"	'Response.Write("ServerPath = " & serverpath & "<br>")	'DEFAULT USER LEVELS 	'sMsgCount = "0" 	'sMemberStatus = "Junior Member" 	sUBBperm = "Write" 	'ddate = Date()    dim fso, f	set fso = CreateObject("Scripting.FileSystemObject")	'If a seperate user file exists, then it's an update!	bolFileExists = fso.FileExists(serverpath & right("00000000" & ubbID, 8) & ".cgi") 	If bolFileExists Then		set f = fso.OpenTextFile( serverpath & right("00000000" & ubbID, 8) & ".cgi", 1)		'	Field 1: UserName<BR>			f.SkipLine		'	Field 2: Password<BR'>	 	f.SkipLine		'	Field 3: Email address<BR>	 	f.SkipLine		'	Field 4: URL<BR>		sUBBurl = f.Readline		'	Field 5: Permissions (Any or none of Write (gives permission to post) and Admin (admin privileges), possibly followed by an &amp; and a list of private forums user is allowed to access (&amp; separated)).<BR>	 	sUBBperm = f.ReadLine		'	Field 6: Occupation<BR>	 	sUBBoccupation = f.ReadLine		'	Field 7: Location<BR>	 	sUBBlocation = f.ReadLine	 	'Response.Write("Location = " & sUBBlocation & "<br>")		'	Field 8: Total Posts<BR>	 	sUBBtotalposts = f.ReadLine	 	If f.AtEndOfStream Then Exit Sub		'	Field 9: Status (Administrator, Moderator, etc..)<BR>		sUBBStatus = f.Readline		If f.AtEndOfStream Then Exit Sub	 	'	Field 10: Interests<BR>	 	sUBBinterests = f.ReadLine	 	If f.AtEndOfStream Then Exit Sub		'	Field 11: Date Registered<BR>	 	sUBBdateregistered = f.ReadLine	 	If f.AtEndOfStream Then Exit Sub		'	Field 12: Allow email address to be viewed? Valid values are "yes" and "no".<BR>	 	bShowEmail = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 13: Signature<BR>		sUBBsignature = f.ReadLine		If f.AtEndOfStream Then Exit Sub		sUBBsignature = Replace(sUBBsignature,"<br>", vbCrlF)		'Field 14: ICQ number<BR>	 	sUBBicq = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 15: Allow BB operators to email in mass mailing? Valid values are "yes" and "no".	 	sUBBmassemail = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 16	 	sUBBDisplayName = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 17		sUBBCustom1 = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 18		sUBBCustom2 = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 19		sUBBCustom3 = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 20		sUBBCustom4 = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 21		sUBBPictureURL = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 22		sUBBPrune = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 23		sUBBAIM = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 24		sUBBEdit = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 25		sUBBProfLock = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 26		sUBBRatings = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 27		sUBBModQueue = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 28		sUBBPM = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 29		sUBBNotify = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 30		sUBBAdminPM = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 31		sUBBLastPost = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 32		sUBBUserTitle = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 33		sUBBBDate = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 34		sUBBParenEmail = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 35		sUBBRegIP = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 36		sUBBInvisible = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 37		sUBBPollBan = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 38		sUBBAvatarPath = f.ReadLine		If f.AtEndOfStream Then Exit Sub		'	Field 39		sUBBAvatarLock = f.ReadLine		If f.AtEndOfStream Then Exit Sub			 	f.Close 	End If	Set fso = Nothing	Set f = Nothing	End Sub'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub WriteUBBUserFile()	Dim fso	Dim tf		Dim tf1	set fso = CreateObject("Scripting.FileSystemObject")		If sUbbPerm = "" Then		sUBBPerm = "Write"	End If		If sUBBStatus = "" Then		sUBBStatus = "Junior Member"	End If	If Not fso.FileExists(serverpath & right("00000000" & lngUserID, 8) & ".cgi") Then		Set tf1 = fso.OpenTextFile(serverpath & "membertotal.cgi",2,True)		tf1.writeline lngUserID		tf1.close			Set tf1 = fso.OpenTextFile(serverpath & "last_number.cgi",2,True)		tf1.writeline ("0000" & lngUserID)		tf1.close		Set tf1 = fso.OpenTextFile(serverpath & "last_approved.cgi",2,True)		tf1.writeline ("0000" & lngUserID)		tf1.close		Set tf1 = Nothing	End If	set tf = fso.CreateTextFile(serverpath & right("00000000" & lngUserID, 8) & ".cgi", true)	tf.writeline "" & strLogin				'Line 1 	tf.writeline "" & strPassword			'Line 2 	tf.writeline "" & strEmail				'Line 3 	tf.writeline ""	& sUBBurl				'Line 4 	tf.writeline sUbbPerm					'Line 5 	tf.writeline "" & sUBBoccupation		'Line 6 	tf.writeline sUBBlocation				'Line 7 	tf.writeline sUBBtotalposts				'Line 8 	tf.writeline sUBBStatus					'Line 9 	tf.writeline sUBBInterests				'Line 10 	tf.writeline Month(dCreationDate) & "-" & Day(dCreationDate) & "-" & Year(dCreationDate)	'Line 11 	tf.writeline bShowEmail					'Line 12 	tf.writeline sUBBsignature				'Line 13 	tf.writeline sUBBicq					'Line 14 	tf.writeline sUBBmassEmail				'Line 15 	tf.writeline strLogin					'Line 16 - display name	tf.writeline sUBBCustom1				'Line 17 - Custom 1	tf.writeline sUBBCustom2				'Line 18 - Custom 2	tf.writeline sUBBCustom3				'Line 19 - Custom 3	tf.writeline sUBBCustom4				'Line 20 - Custom 4	tf.writeline sUBBPictureURL				'Line 21 - Picture URL	tf.writeline sUBBPrune					'Line 22 - Days Prune	tf.writeline sUBBAIM					'Line 23 - AIM ID	tf.writeline sUBBEdit					'Line 24 - Last Edit Info	tf.WriteLine sUBBProfLock				'Line 25 - Profile Locked	tf.writeline sUBBRatings				'Line 26 - Allow User Ratings	tf.WriteLine sUBBModQueue				'Line 27 - Awaiting Queue	tf.writeline sUBBPM						'Line 28 - Allow PM's	tf.writeline sUBBNotify					'Line 29 - Email Notify on PM	tf.WriteLine sUBBAdminPM				'Line 30 - Allow Admin to Pm	tf.writeline sUBBLastPost				'Line 31 - Last Post Info	tf.writeline sUBBUserTitle				'Line 32 - Admin-assigned user title	tf.WriteLine sUBBBDate					'Line 33 - Birthdate	tf.WriteLine sUBBParenEmail				'Line 34 - Parental Email	tf.WriteLine sUBBRegIP					'Line 35 - Registration IP	tf.WriteLine sUBBInvisible				'Line 36 - Invisible?	tf.writeline sUBBPollBan				'Line 37 - BanPoll	tf.writeline sUBBAvatarPath				'Line 38 - Rel or abs avatar URL	tf.writeline sUBBAvatarLock				'Line 39 - Lock user avatar 	tf.close 		Set tf = Nothing	Set fso = NothingEnd Sub'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function CreateBBSFiles(sUBBLogin)	Dim objDBUBB	Dim objRSUBB	Dim SQLUBB	Dim fso	Dim f	Dim sMemberStatus	Dim sPerms	Dim ddate	Dim tf	Dim tfEmailFile	Dim tfMemberList	'Dim serverpath	Dim bolIsUpdate		Set objDBUBB = Server.CreateObject("ADODB.Connection")	objDBUBB.Open DATABASE	serverpath=server.mappath(".") & "\..\..\data\Members\"		'DEFAULT USER LEVELS 	If Cstr(sUBBtotalposts)= "" Then 		sUBBtotalposts = "0" 	End If 	sMemberStatus = "Junior Member" 	sPerms = "Write" 	'ddate = Date()    	set fso = CreateObject("Scripting.FileSystemObject")	If (sPerms = "") Then sPerms = "Write"	'Response.Write("<h1>"&lnguserID&"</h1>")	If lngUserid = 0 Then		SQLUBB = "select * from user where login = '" & sUBBLogin & "'"		Set objRSUBB = objDBUBB.Execute(SQLUBB) 		lngUserid = objRSUBB("userid") 		If ( Not objRSUBB.EOF ) Then 			WriteUBBUserFile() 		End IF	 		objRSUBB.Close		Set objRSUBB = Nothing 	Else 		WriteUBBUserFile() 	End If 		''''''''''''''''''''''''''''''''''''''''	' Write emaillist.cgi & memberlist.cgi '	''''''''''''''''''''''''''''''''''''''''		SQLUBB = "select * from user order by CInt(userid)"	Set objRSUBB = objDBUBB.Execute(SQLUBB)	set tfEmailFile = fso.CreateTextFile(serverpath & "emailfile.cgi", true)	set tfMemberList = fso.CreateTextFile(serverpath & "memberslist.cgi", true)		While Not objRSUBB.EOF		Dim email		email = objRSUBB("email") & "||" & right("00000000" & objRSUBB("UserID"), 8)		tfEmailFile.WriteLine email		tfMemberList.WriteLine objRSUBB("login") & "|!!|" & right("00000000" & objRSUBB("userid"), 8)		objRSUBB.MoveNext	Wend	tfEmailFile.Close	tfMemberList.Close	Set tfEmailFile = Nothing	Set tfMemberList = Nothing		Set tf = Nothing	Set fso = Nothing	objRSUBB.Close 	Set objRSUBB = NothingEnd Function 'CreateBBSFiles'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Dim objDBDim objRSDim sDBNameDim sActionDim sErrorDim strPageHeadingDim lngUseridDim strLoginDim strEmailDim strPasswordDim strPassword2Dim strFirstnameDim strLastnameDim strPhoneDim strZipDim lngUserlevelDim lngBandIDFav1Dim lngVenueIDFav1Dim strEmailList1Dim strEmailList2Dim localUserIDDim tempDim strBodyDim bolNewPassword ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub User_GetData()	'TODO: Modify the SQL in objDB.Execute to fit your needs...	'Response.Write("select * from User where userid = " & localUserID)	Set objRS = objDB.Execute("select * from User where userid = " & localUserID)	If objRS.EOF Then		lngUserid = ""		strLogin = ""		strEmail = ""		strPassword = ""		strFirstname = ""		strLastname = ""		strPhone = ""		strZip = ""		lngUserlevel = ""		lngBandIDFav1 = ""		lngVenueIDFav1 = ""		strEmailList1 = YES		strEmailList2 = YES	Else		lngUserid = objRS("Userid")		strLogin = objRS("Login")		strEmail = objRS("Email")		strPassword = objRS("Password")		strFirstname = objRS("Firstname")		strLastname = objRS("Lastname")		strPhone = objRS("Phone")		strZip = objRS("Zip")		lngUserlevel = objRS("userlevel")		lngBandIDFav1 = objRS("bandIDFav1")		lngVenueIDFav1 = objRS("venueIDFav1")		strEmailList1 = objRS("emailList1")		strEmailList2 = objRS("emailList2")		dCreationDate = objRS("CreationDate")		sUBBoccupation = objRS("occupation")		sUBBlocation = objRS("location")		sUBBsignature = objRS("signature")		sUBBicq = objRS("ICQ")		sUBByahoo = objRS("yahoo")		sUBBinterests = objRS("interests")				ReadUBBFile(lngUserID)			End If	End Sub''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function RequiredToChangePassword(sPassword)	Select Case sPassword		Case RANDOMPASSWORD			RequiredToChangePassword = TRUE		Case OLDRANDOMPASSWORD			RequiredToChangePassword = TRUE		Case CHANGEEMAILPASSWORD			RequiredToChangePassword = TRUE		Case FORGETPASSWORD			RequiredToChangePassword = TRUE		Case Else			RequiredToChangePassword = FALSE	End SelectEnd Function''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub User_DisplayForm()		Dim strChecked		Response.Write("Please make your changes then press the Update button.<p>")	Response.Write("<font color=red>" & sError & "</font><p>")	Response.Write("<form name=form1 method=Post action=" & CURRENT_PAGE & ">")	RequiredLegend()	Response.Write("<table width="& TABLEWIDTH &" cellpadding=2 cellspacing=2>")	FieldDesc "Enter a login.", "You will utilize this when you log into Windyhop."	Response.Write("<tr bgcolor=" & requiredColor &"><td>Login:</td><td>")		If Not HasRights("changeuserlogin", Session("userlevel")) Then		If localUserID = 0 Then			Response.Write("<input size=" & LOGIN_MAX_LENGTH & " maxlength=" & LOGIN_MAX_LENGTH & " name=strLogin maxlength=10 value=" & Chr(34) & strLogin & Chr(34) & "></td></tr>")		Else			Response.Write(strLogin & "<input type=hidden name=strLogin value=""" & strLogin & """></td></tr>")		End If	Else 		Response.Write("<input size=" & LOGIN_MAX_LENGTH & " maxlength=" & LOGIN_MAX_LENGTH & " name=strLogin value=" & Chr(34) & strLogin & Chr(34) & "></td></tr>")				End If				FieldDesc "Enter a valid email address.", "If you are signing up for the first time OR you are changing your address, a random password will be sent it to verify the address."	%><tr bgcolor=<%=requiredColor%>><td>Email:</td><td><input size=40 name=strEmail value="<%=strEmail%>" maxlength=50></td></tr>	<%	If ((bolNewPassword = FALSE) and (strPassword <> RANDOMPASSWORD)) Then		FieldDesc "Enter a password.", "Passwords are NOT case sensitive"		Response.Write("<tr bgcolor=" & requiredColor &"><td>Password:</td><td><input size=20 type=password name=strPassword value=" & Chr(34) & strPassword & Chr(34) & "></td></tr>")		Response.Write("<tr bgcolor=" & requiredColor &"><td>Confirm Password:</td><td><input size=20 type=password name=strPassword2 value=" & Chr(34) & strPassword & Chr(34) & "></td></tr>")	Else		Response.Write("<tr bgcolor=" & requiredColor &"><td>Password:</td><td>")		Response.Write("<input type=hidden name=strPassword value=" & RANDOMPASSWORD & ">")		Response.Write("<input type=hidden name=strPassword2 value=" & RANDOMPASSWORD & ">Your randomly generated password will be emailed to the address above.</td></tr>")	End If		FieldDesc "Enter your name.", "'nuff said."	Response.Write("<tr bgcolor=" & requiredColor &"><td>Firstname:</td><td><input size=50 maxlength=50 name=strFirstname value=" & Chr(34) & strFirstname & Chr(34) & "></td></tr>")	Response.Write("<tr bgcolor=" & requiredColor &"><td>Lastname:</td><td><input size=50 maxlength=50 name=strLastname value=" & Chr(34) & strLastname & Chr(34) & "></td></tr>")		'Location	Response.Write("<tr bgcolor=" & sRowColor &"><td>" & LOUNGE_STAR & "City & State</td><td>")	%><input name=UbbLocation size=30 maxlength=100 value="<%=sUBBlocation%>"> <%	Response.Write("</td></tr>")	'ZIP	FieldDesc "Enter your zip.", "This is an optional field that we will use in future releases to further customize your experience."	Response.Write("<tr bgcolor=" & sRowColor &"><td>Zip:</td><td><input size=5 maxlength=5 name=strZip value=" & Chr(34) & strZip & Chr(34) & "></td></tr>")		'Favorite Band	FieldDesc "Who's your favorite band?", "We will use this information to tailor the site to your interests."	Response.Write("<tr bgcolor=" & sRowColor &"><td>Favorite Band:</td><td>")	BuildDropDown "band", "SELECT BandID, Name as label from band order by name", lngBandIDFav1	Response.Write("</td></tr>")	'Favorite Venue	FieldDesc "What's your favorite venue?", "Want to have the site tell you what going on at your favorite hang out?  Enter it here."	Response.Write("<tr bgcolor=" & sRowColor &"><td>Favorite Venue:</td><td>")	BuildDropDown "venue", "SELECT VenueID, Name as label from venue order by name", lngVenueIDFav1	Response.Write("</td></tr>")	'ICQ Number	FieldDesc "What's your ICQ Number?","Want other Windyhop users to be able to contact you? <a href=http://www.icq.com target=_blank>What's ICQ?</a>"	Response.Write("<tr bgcolor=" & sRowColor &"><td>" & LOUNGE_STAR & "ICQ Number:</td><td>")	%><input name=UBBicq maxlength=10 size=10 value="<%=sUBBicq%>"> <%	Response.Write("</td></tr>")	'Yahoo! Messenger	FieldDesc "Do you use Yahoo Messenger?","Want other Windyhop users to be able to contact you on Yahoo!? <a href=http://messenger.yahoo.com target=_blank>What's Yahoo! Messenger?</a>"	Response.Write("<tr bgcolor=" & sRowColor &"><td>" & LOUNGE_STAR & "Yahoo! Messenger Name:</td><td>")	%><input name=UBByahoo maxlength=20 size=15 value="<%=sUBByahoo%>"> <%	Response.Write("</td></tr>")		'Homepage	FieldDesc "Where do you call your virtual home?","Put your homepage here."	Response.Write("<tr bgcolor=" & sRowColor &"><td>" & LOUNGE_STAR & "Homepage:</td><td>")	%><input name=UBBurl maxlength=50 size=50 value="<%=sUBBurl%>"> <%	Response.Write("</td></tr>")		'Interests	FieldDesc "What other interests do you have (other than swing!)?","Show us your many facets."	Response.Write("<tr bgcolor=" & sRowColor &"><td>" & LOUNGE_STAR & "Interests:</td><td>")	%><input name=UBBinterests size=50 maxlength=100 value="<%=sUBBinterests%>"> <%	Response.Write("</td></tr>")	%>	<input type=hidden name=ubbperm value="<%=sUBBperm%>">	<input type=hidden name=ubbstatus value="<%=sUBBStatus%>">	<input type=hidden name=ubbdateregistered value="<%=sUBBdateregistered%>">	<input type=hidden name=ubbtotalposts value="<%=sUBBtotalposts%>">	<input type=hidden name=creationdate value="<%=dCreationDate%>">	<%		'Occupation	Response.Write("<tr bgcolor=" & sRowColor &"><td>" & LOUNGE_STAR & "Occupation:</td><td>")	%><input name=Ubboccupation size=30 value="<%=sUBBoccupation%>"> <%	Response.Write("</td></tr>")		'Signature	FieldDesc "Signature." ,"Want a signature in our Hepster's Lounge?  Put your John Hancock here. <small>(No HTML allowed. <a href=""/ubb/ubb2/ubbcode.html"" target=_blank>UBB Code Allowed</a>)</small>"	Response.Write("<tr bgcolor=" & sRowColor &"><td>" & LOUNGE_STAR & "Hepster's Lounge Signature</td><td>")	%><textarea name=UBBsignature rows=4 cols=50><%=sUBBSignature%></textarea> <%	Response.Write("</td></tr>")		' If they are signing up, ask them how they heard about us.		If bolNewPassword=TRUE or strPassword=RANDOMPASSWORD Then		FieldDesc "How did you hear about us?","Yahoo?!? Another swing site? Flyer? Some bum ranting on the street?"		Response.Write("<tr bgcolor=" & sRowColor &"><td colspan=2>")				%><input name=howdidyouhear size=60 title=b maxlength=60> <%		Response.Write("</td></tr>")	End If		'Receive Email 	Response.Write("<tr bgcolor=" & sRowColor &"><td colspan=2>")	If strEmailList1 = YES Then		strChecked = " " & CHECKED & " "	Else		strChecked = " "	End If	Response.Write("<input type=checkbox name=EmailList1 value=" & YES & strChecked & ">")	REsponse.Write(" Yes! I would like to receive email regarding upcoming swing events, updates to Windyhop, and other " & _	               " info I need. </td>")	               	'Show Email    	'Response.Write("<tr bgcolor=" & sRowColor &"><td colspan=2>")	'If bShowEmail = YES Then	'	strChecked = " " & CHECKED & " "	'Else	'	strChecked = " "	'End If	'Response.Write("<input type=checkbox name=ubbShowEmail value=" & YES & strChecked & ">")	'REsponse.Write("Show my email address to other users." & LOUNGE_STAR & "</td>")		Response.Write("<input type=hidden name=ubbShowEmail value=" & NO & ">")	Response.Write("<input type=hidden name=sUBBAvatarLock value=" & sUBBAvatarLock & ">")		Response.Write("<input type=hidden name=sUBBAvatarPath value=" & sUBBAvatarPath & ">")	Response.Write("<input type=hidden name=sUBBPollBan value=" & sUBBPollBan & ">")	'Response.Write("<input type=hidden name=sUBBUserTitle value=" & sUBBUserTitle & ">")	Response.Write("<input type=hidden name=sUBBLastPost value=" & sUBBLastPost & ">")	Response.Write("<input type=hidden name=sUBBNotify value=" & sUBBNotify & ">")	Response.Write("<input type=hidden name=sUBBPM value=" & sUBBPM & ">")	Response.Write("<input type=hidden name=sUBBRatings value=" & sUBBRatings & ">")	Response.Write("<input type=hidden name=sUBBEdit value=" & sUBBEdit & ">")	Response.Write("<input type=hidden name=sUBBPrune value=" & sUBBPrune & ">")	Response.Write("<input type=hidden name=sUBBDisplayName value=" & sUBBDisplayName & ">")	Response.Write("<input type=hidden name=sUBBCustom1 value=" & sUBBCustom1 & ">")	Response.Write("<input type=hidden name=sUBBCustom2 value=" & sUBBCustom2 & ">")	Response.Write("<input type=hidden name=sUBBCustom3 value=" & sUBBCustom3 & ">")	Response.Write("<input type=hidden name=sUBBCustom4 value=" & sUBBCustom4 & ">")	Response.Write("<input type=hidden name=sUBBPictureURL value=" & sUBBPictureURL & ">")	Response.Write("<input type=hidden name=sUBBDaysPrune value=" & sUBBDaysPrune & ">")	Response.Write("<input type=hidden name=sUBBAIM value=" & sUBBAIM & ">")	Response.Write("<input type=hidden name=sUBBLastEdit value=" & sUBBLastEdit & ">")	Response.Write("<input type=hidden name=sUBBProfLock value=" & sUBBProfLock & ">")	Response.Write("<input type=hidden name=sUBBAllowRatings value=" & sUBBAllowRatings & ">")	Response.Write("<input type=hidden name=sUBBModQueue value=" & sUBBModQueue & ">")	Response.Write("<input type=hidden name=sUBBAllowPMS value=" & sUBBAllowPMS & ">")	Response.Write("<input type=hidden name=sUBBAdminPM value=" & sUBBAdminPM & ">")	Response.Write("<input type=hidden name=sUBBLastPostInfo value=" & sUBBLastPostInfo & ">")	Response.Write("<input type=hidden name=sUBBUserTitle value='" & sUBBUserTitle & "'>")	Response.Write("<input type=hidden name=sUBBBdate value=" & sUBBBdate & ">")	Response.Write("<input type=hidden name=sUBBParenEmail value=" & sUBBParenEmail & ">")	Response.Write("<input type=hidden name=sUBBRegIP value=" & sUBBRegIP & ">")	Response.Write("<input type=hidden name=sUBBInvisible value=" & sUBBInvisible & ">")	Response.Write("<input type=hidden name=sUBBBanPoll value=" & sUBBBanPoll & ">")		If Not HasRights("changeuserlevel", Session("userlevel")) Then		If lngUserLevel = "" Then 			lngUserLevel = NOPRIVUSER		End If		Response.Write("<input type=hidden size=20 name=userlevel value=" & Chr(34) & lngUserlevel & Chr(34) & "></td></tr>")	Else ' they are an admin'		Response.WRite("lngUserlevel = " & lngUserlevel &"<br><br>")		Response.Write("<tr bgcolor=" & sRowColor &"><td>User Level:</td><td>")		BuildUserLevelRadio(lngUserlevel)	End If 'HasRights("changeuserlevel", Session("userlevel"))		Response.Write("<input type=hidden name=userid value=" & localUserID & ">")	Response.Write("</table>")	Response.Write(LOUNGE_STAR & "Used in Hepster's Lounge & viewable by all users.<br><br>")	Response.Write("<input type=submit name=action value=Update>")	Response.Write("</form>")	End Sub''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function ValidateSignature(sSig)	Dim sTemp	sTemp = StripHTMLTag(sSig)	sTemp = Replace(sTemp,vbCrlF,"<br>")	ValidateSignature = sTempEnd Function''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub User_ValidateData()		lngUserid = Request.Form("userid")	strLogin = Request.Form("strLogin")	strEmail = Request.Form("strEmail")	strPassword = Request.Form("strPassword")	strPassword2 = Request.Form("strPassword2")	strFirstname = Request.Form("strFirstname")	strLastname = Request.Form("strLastname")	strPhone = FormatPhoneNumber(Request.Form("strPhone"))	strZip = Request.Form("strZip")	lngUserlevel = Request.Form("userlevel")	lngBandIDFav1 = Request.Form("bandid")	sUBBsignature = Request.Form("ubbsignature")	sUBBicq = Request.Form("ubbicq")	sUBByahoo = Request.Form("ubbyahoo")	sUBBoccupation = Request.Form("ubboccupation")	sUBBlocation = Request.Form("ubblocation")	sUBBperm = Request.Form("ubbperm")	sUBBstatus = Request.Form("ubbstatus")	sUBBtotalposts = Request.Form("ubbtotalposts")	sUBBdateregistered = Request.Form("creationdate")	sUBBinterests = Request.Form("ubbinterests")	bShowEmail = Request.Form("ubbShowEmail")	dCreationDate = Request.Form("creationdate")	sUBBurl = Request.Form("ubbURL")	strHowDidYouHear = Request.Form("HowDidYouHear")	sUBBAvatarLock = Request.Form("sUBBAvatarLock")	sUBBAvatarPath = Request.Form("sUBBAvatarPath")	sUBBPollBan = Request.Form("sUBBPollBan")	sUBBUserTitle = Request.Form("sUBBUserTitle")	sUBBLastPost = Request.Form("sUBBLastPost")	sUBBNotify = Request.Form("sUBBNotify")	sUBBPM = Request.Form("sUBBPM")	sUBBRatings = Request.Form("sUBBRatings")	sUBBEdit = Request.Form("sUBBEdit")	sUBBPrune = Request.Form("sUBBPrune")	sUBBDisplayName = Request.Form("sUBBDisplayName")	sUBBCustom1 = Request.Form("sUBBCustom1")	sUBBCustom2 = Request.Form("sUBBCustom2")	sUBBCustom3 = Request.Form("sUBBCustom3")	sUBBCustom4 = Request.Form("sUBBCustom4")	sUBBPictureURL = Request.Form("sUBBPictureURL")	sUBBDaysPrune = Request.Form("sUBBDaysPrune")	sUBBAIM = Request.Form("sUBBAIM")	sUBBLastEdit = Request.Form("sUBBLastEdit")	sUBBProfLock = Request.Form("sUBBProfLock")	sUBBAllowRatings = Request.Form("sUBBAllowRatings")	sUBBModQueue = Request.Form("sUBBModQueue")	sUBBAllowPMS = Request.Form("sUBBAllowPMS")	sUBBAdminPM = Request.Form("sUBBAdminPM")	sUBBLastPostInfo = Request.Form("sUBBLastPostInfo")	'sUBBCustomTitle = Request.Form("sUBBUserTitle")	sUBBBdate = Request.Form("sUBBBdate")	sUBBParenEmail = Request.Form("sUBBParenEmail")	sUBBRegIP = Request.Form("sUBBRegIP")	sUBBInvisible = Request.Form("sUBBInvisible")	sUBBBanPoll = Request.Form("sUBBBanPoll")	sUBBsignature = ValidateSignature(sUBBsignature)		If bShowEmail <> YES Then		bShowEmail = NO		End If	If strEmailList1 <> YES Then		strEmailList1 = NO		End If		If lngBandIDFav1 = DEFAULT Then		lngBandIDFav1 = 0	End If	lngVenueIDFav1 = Request.Form("venueid")	If lngVenueIDFav1 = DEFAULT Then		lngVenueIDFav1 = 0	End If		strEmailList1 = Request.Form("emaillist1")	strEmailList2 = Request.Form("emaillist2")		If lnguserid = "" Then		lnguserid = 0	End If		Dim strSQL	Dim strHowDidYouHear	If InStr(1,strLogin,"'") <> 0 Then		sError = sError & "Login cannot contain ""'""<br>"	Else				strSQL = "select login from user where login = '" & strLogin & "' AND userid <> " & lnguserid		If lcase(strLogin) = lcase(GetOneField(strSQL, "login")) Then			sError = sError & "Login name already taken.  Please choose another.<br>"		End If				strSQL = "Select email from user where login = '" & strLogin & "'"		If strEmail <> GetOneField(strSQL, "email") AND (strPassword <> RANDOMPASSWORD) Then			strPassword = CHANGEEMAILPASSWORD			strPassword2 = CHANGEEMAILPASSWORD			Session("userlevel") = ""			Session("userid") = ""			Session("firstname") = ""			Session("lastname") = ""			Session("login") = ""			Session("name") = ""			Response.Cookies("userid") = ""			Response.Cookies("userid").Expires = Date+365		End If	End If		If lngUserid = "" Then		sError = sError & "Userid is a required field.<br>"	End If 	If strLogin = "" Then		sError = sError & "Login is a required field.<br>"	End If 	If strEmail = "" Then		sError = sError & "Email is a required field.<br>"	End If 		If InStr(strEmail,"@") = 0 Then		sError = sError & "Must be a valid email address (you@domain.com)<br>"	End If		If strPassword = "" Then		sError = sError & "Password is a required field.<br>"	End If 		If strPassword <> strPassword2 Then		sError = sError & "Passwords do not match. Please retype them.<br>"	End If 	If strFirstname = "" Then		sError = sError & "Firstname is a required field.<br>"	End If 	If strLastname = "" Then		sError = sError & "Lastname is a required field.<br>"	End If 	'If strPhone = "" Then	'	sError = sError & "Phone is a required field.<br>"	'End If 		'If strPhone = "ERROR" Then	'	sError = sError & "Phone must be a valid 10-digit phone number.<br>"	'End If	'If strZip = "" Then	'	sError = sError & "Zip is a required field.<br>"	'End If 	If lngUserlevel = "" Then		sError = sError & "Userlevel is a required field.<br>"	End If 		If sError <> "" Then		User_DisplayForm()		Response.End	Else		'TODO: Determine if you need to do an AddNew or update an existing record...		Set objRS = Server.CreateObject("ADODB.Recordset")        If localUserID = 0 Then             'since there is no UniqueRecordID, this must be a new record...		 	objRS.open "User", objDB, adOpenKeyset, adLockOptimistic            objRS.AddNew		 	objRS("CreationDate") = Date & " " & Time		 	Response.Write("<table bgcolor = "&sRowColor & "><tr><td>")		 	Response.Write("<h3>Thank you!</h3>")		 	Response.Write("Your password will be emailed to you shortly.<p>")		 	Response.Write("</td></tr></table><p>")		Else			'must be modifying an existing record...			objRS.open "select * from user where userid = " & localUserID, _		 					objDB, adOpenKeyset, adLockOptimistic        End If				objRS("Login") = strLogin		objRS("Email") = strEmail		objRS("Password") = strPassword		objRS("Firstname") = strFirstname		objRS("Lastname") = strLastname		objRS("Phone") = "  " 'strPhone		objRS("Zip") = strZip		objRS("Userlevel") = lngUserlevel		objRS("BandIDFav1") = lngBandIDFav1		objRS("VenueIDFav1") = lngVenueIDFav1		objRS("EmailList1") = strEmailList1		objRS("EmailList2") = strEmailList2		objRS("URL") = sUBBurl		objRS("occupation") = sUBBoccupation		objRS("location") = sUBBlocation		objRS("signature") = sUBBsignature		objRS("ICQ") = sUBBicq		objRS("yahoo") = sUBByahoo		objRS("interests") = sUBBinterests			objRS.Update				If Err = 0 Then			Response.Write("<table width=100% >")						Response.Write("The following data was updated successfully:")			WriteTableRow "FIELD", "DATA", HEADING			'WriteTableRow "UserID:", lngUserID, ""			WriteTableRow "Login:", strLogin, ""			WriteTableRow "First Name:", strFirstName, ""			WriteTableRow "Last Name:", strLastName , ""			WriteTableRow "email:", strEmail , ""			If strPassword = RANDOMPASSWORD or strPassword = CHANGEEMAILPASSWORD Then								If strPassword = RANDOMPASSWORD Then											'email the user					WriteTableRow "Password:", "Your password will be mailed to "&strEmail&".", ""					strBody = "Welcome "& strFirstName & " to Windyhop! " & vbcrlf & _							vbcrlf & _							"We are very exicited " & _							"about your involvement in Windyhop, and look forward to serving your swing " & _							"and lindy needs.  Your login/password can be found below: " & vbcrlf & _						 		vbcrlf & _							"LOGIN: " & strLogin & vbcrlf & _							"PASSWORD: " & strPassword & vbcrlf & _						 		vbcrlf & _							"Please log into http://www.windyhop.org as soon as you can to change your password. If you" & _							" have any more questions, please email us at admin@windyhop.org." & vbcrlf & _						 		vbcrlf & _							"Cheers, " & vbcrlf &_							"Punches & Mugsy (Windyhop admins)"					SendMail "Windyhop", "admin@windyhop.org", strEmail,"Your Windyhop Password",strBody					'''''''''''''''''''''''''''''''''''''''					'Sub NotifyAdminNewUser(strLogin,strHowDidYouHear)								Dim item																					If strHowDidYouHear = "" Then								strHowDidYouHear = "thin air, bozos"							End If														'SwingBot sends his love							strBody = 	"*INCOMING MESSAGE FROM SWINGBOT, RULER OF WINDYHOP...*"& vbcrlf & _										vbcrlf & _										"A new user has signed up with the site.  We are one more closer to world domination." & vbcrlf & _										vbcrlf & _										"Rumor has it that they found us from " & strHowDidYouHear & ". " & vbcrlf & vbcrlf & _										"Love," & vbcrlf & _										"SwingBot" & vbcrlf & "(you guys rule.)" & vbCrlF																											strBody = strBody & "==========================" & vbCrlF							For each item in objRS.Fields								If lcase(item.Name) <> "password" Then 									strBody = strBody & UCase(item.Name) & ": " 									strBody = strBody & item.Value & vbCrlF								End If							Next							strBody = strBody & "==========================" & vbCrlF														SendMail "SwingBot", "swingbot@windyhop.org", "admin@windyhop.org", "New User "&strLogin&" Signed Up", strBody											'''''''''''''''''''''''''''''''''''''''									ElseIf strPassword = CHANGEEMAILPASSWORD Then					WriteTableRow "Password:", "Because of the change of email address, your password will be mailed to "&strEmail&".", ""					strBody = "Hello, " & strFirstName & "!" & vbCrlF & _							  " Your login/password can be found below: " & vbcrlf & _						 		vbcrlf & _							"LOGIN: " & strLogin & vbcrlf & _							"PASSWORD: " & strPassword & vbcrlf & _						 		vbcrlf & _							" If you have any more questions, please email us at admin@windyhop.org." & vbcrlf & _						 		vbcrlf & _							"Cheers, " & vbcrlf &_							"Punches & Mugsy (Windyhop admins)"					SendMail "", "admin@windyhop.org", strEmail,"Your Windyhop Password",strBody				End If												If Replace(strHowDidYouHear, " ", "") = "" Then					strHowDidYouHear = "thin air"				End If						End If			'WriteTableRow "Phone", strPhone , ""			WriteTableRow "Zip:", strZip , ""						WriteTableRow "Favorite Band:",  GetName("Band", "Name", lngBandIDFav1), ""			WriteTableRow "Favorite Venue:",  GetName("Venue", "Name", lngVenueIDFav1), ""			WriteTableRow "Occupation:", sUBBoccupation, ""			WriteTableRow "Location:", sUBBlocation, ""			WriteTableRow "Interests:", sUBBInterests, ""			WriteTableRow "ICQ Number:", sUBBicq, ""			WriteTableRow "Yahoo Messenger:", sUBByahoo, ""			WriteTableRow "Signature:", sUBBsignature, ""				WriteTableRow "Homepage:", sUBBurl, ""			If strEmailList1 <> YES Then				strEmailList1 = NO			End If			WriteTableRow "Receive Email:", strEmailList1, ""			'WriteTableRow "Show Email Address:", bShowEmail, ""			WriteTableRow "Date Registered:", dCreationDate, ""			Response.Write("</table>")			Response.Write("<p> <a href=default.asp>Back to Home</a>")			If strPassword = CHANGEEMAILPASSWORD Then				Session("userlevel") = ""				Session("userid") = ""				Session("firstname") = ""				Session("lastname") = ""				Session("login") = ""				Session("name") = ""				Response.Cookies("userid") = ""				Response.Cookies("userid").Expires = Date+365			End If			'Response.End		End If	End If	objRS.Close	objDB.Close	Set objRS = Nothing	Set objDB = NothingEnd Sub 'User_ValidateData()''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub DisplayBenefits()	%>	<H1>Register with Windyhop!</H1>	<P>When you register with Windyhop, you get:</P>	<UL>	  <LI>Weekly Chicago Swing Schedule, the <EM>Zoot Scoop</EM></LI>	  <LI>Access to Hepster's Lounge, our online bulletin board</LI>	  <LI>Customization of your visits at Windyhop</LI>	  <LI>Become part of Chicago's Online Swing&nbsp;&amp; Lindy Community!</LI></UL>	<P>It's fast, easy, and FREE! <a href="<%=CURRENT_PAGE%>?action=signup">Sign up now!</a></P>	<%End Sub 'DisplayBenefits()''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Dim serverpathDim sUBBurlDim sUBBpermDim sUBBStatusDim sUBBoccupationDim sUBBlocationDim sUBBtotalpostsDim sUBBdateregisteredDim sUBBsignatureDim sUBBmassemailDim sUBBicqDim sUBByahooDim sUBBinterestsDim dCreationDateDim bShowEmailDim sUBBAvatarLockDim sUBBAvatarPathDim sUBBPollBanDim sUBBUserTitleDim sUBBLastPostDim sUBBNotifyDim sUBBPMDim sUBBRatingsDim sUBBEditDim sUBBPruneDim sUBBDisplayNameDim sUBBCustom1Dim sUBBCustom2Dim sUBBCustom3Dim sUBBCustom4Dim sUBBPictureURLDim sUBBDaysPruneDim sUBBAIMDim sUBBLastEditDim sUBBProfLockDim sUBBAllowRatingsDim sUBBModQueueDim sUBBAllowPMSDim sUBBAdminPMDim sUBBLastPostInfoDim sUBBCustomTitleDim sUBBBdateDim sUBBParenEmailDim sUBBRegIPDim sUBBInvisibleDim sUBBBanPollCONST LOUNGE_STAR = "<font color=red><b>*</b></font>"Set objDB = Server.CreateObject("ADODB.Connection")objDB.Open DATABASE'This tells us if they've clicked the Update button...sAction = Request("action")localUserID = Request.Form("UserID")If localUserID = "" Then	localUserID = Request.QueryString("userid")	If localUserID <> "" Then		If Session("userid") = "" Then Session("userid") = 0		If FormatNumber(localUserID) <> FormatNumber(Session("userid")) Then			localUserID = ""			Response.Write("Error. <a href=edit.asp>Go back to the Edit page.</a>")			Response.End		End If	End IfEnd IfstrPageHeading = "Edit Existing User"'Response.Write("<h1> hi" & localUserID & "</h1>")'bolWhere = FALSEIf localUserID = "" or localUserID = 0 Then	localUserID = 0	strPageHeading = "New User"	'bolWhere = TRUEEnd IfbolNewPassword = FALSEIf sAction = "Edit User" or Request.QueryString("userid") <> "" Then	Response.Write("<h1>" & strPageHeading & "</h1>")	User_GetData()	objRS.Close	objDB.Close	Set objRS = Nothing	Set objDB = Nothing	If RequiredToChangePassword(strPassword) = TRUE  Then		Response.Write("<table bgcolor = "&sRowColor & "><tr><td>")		Response.Write("<h3>Change your Password</h3>")		Response.Write("Thanks for logging in!  Please change your password to <br> something you can remember.<p>")		Response.Write("</td></tr></table><p>")		strPassword = ""	End IF	User_DisplayForm()ElseIf sAction = "Update" Then	Response.Write("<h1>" & strPageHeading & "</h1>")	User_ValidateData()				'If localUserID <> 0 Then	'Response.Write("<h1>hello " & strLogin & "</h1>")	CreateBBSFiles strLoginElseIf lcase(sAction) = "signup" Then	Response.Write("<h1>" & strPageHeading & "</h1>")	strEmailList1 = YES	strEmailList2 = YES	bShowEmail = YES	bolNewPassword = TRUE	dCreationDate = Now	User_DisplayForm()Else	DisplayBenefits()End If	'Response.Write("<br>Password = " & strPassword & "<br>")%><!-- #include file="../include/newbottom.txt" -->