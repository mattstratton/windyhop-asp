<!-- #include file="../include/newtop.txt" --> <!-- #include file="../include/libnews.inc" --><!-- #include file="../include/approvedtext.inc" --><!-- #include file="../include/writetablerow.inc" --> <!-- #include file="../include/getname.inc" --> <!-- #include file="../include/libformobjects.inc" --> <%Dim objDBDim objRSDim sDBName'Dim sActionDim sErrorDim strFilenameDim strNameDim strCategoryDim datCreationdateDim datUpdatedateDim datBegineffdateDim datEndeffdateDim lngUseridDim strApprovedDim strNewsBodyDim strNewsTitleDim strNewsBlurbDim strNewsURLDim lngPriorityDim strPriorityCheckedDim localNewsIDDim objFSODim strFilePath''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub GetData()	Dim objNewsFile		Set objRS = objDB.Execute("select * from News where newsID ="&localNewsID)		If objRS.EOF Then		localNewsID = ""		strName = ""		strFilename = ""		strCategory = ""		datCreationdate = ""		datUpdatedate = ""		datBegineffdate = DATE		datEndeffdate = ""		lngUserid = ""		strApproved = ""	Else		localNewsID = objRS("Newsid")		'localNewsID = localNewsID		strName = objRS("Name")		strNewsTitle = strName		strFilename = objRS("Filename")		strCategory = objRS("Catagory")		datCreationdate = objRS("Creationdate")		datUpdatedate = objRS("Updatedate")		datBegineffdate = objRS("Begineffdate")		datEndeffdate = objRS("Endeffdate")		lngUserid = objRS("Userid")		strApproved = objRS("Approved")		lngPriority = objRS("Priority")				Set objNewsFile = objFSO.OpenTextFile(strFilePath&strFilename)		strNewsTitle = objNewsFile.Readline		strNewsURL = objNewsFile.Readline		strNewsBlurb = objNewsFile.Readline		strNewsBody = objNewsFile.ReadAll	End If			End Sub''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub DisplayForm()	'Dim sRowColor	'sRowColor="#C4CEE5"	Response.Write("Please make your changes then press the Update button.<p>")	Response.Write("<font color=red>" & sError & "</font><p>")	Response.Write("<form name=form1 method=Post action=editnews.asp>")	Response.Write("<table cellpadding=2 cellspacing=2>")	Response.Write("<tr bgcolor=" & sRowColor &"><td>Newsid:</td><td>"&localNewsID&"<input type=hidden name=localNewsID value=" & localNewsID  & "></td></tr>")	Response.Write("<tr bgcolor=" & sRowColor &"><td>Name:</td><td><input size=40 name=strName value=" & Chr(34) & strName & Chr(34) & "></td></tr>")	Response.Write("<tr bgcolor=" & sRowColor &"><td>Filename:</td><td>"&strFilename&"<input type=hidden name=strFilename value=" & Chr(34) & strFilename & Chr(34) & "></td></tr>")		'category	Response.Write("<tr bgcolor=" & sRowColor &"><td>Category:</td><td>")	BuildDropDown "Category", "Select Name as label, CategoryID from Category order by name", strCategory	Response.Write("</td></tr>")		'PRIORITY	Response.Write("<tr bgcolor=" & sRowColor &"><td>Priority:</td><td>")	BuildPriorityRadio lngPriority, ""	Response.Write("</td></tr>")		Response.Write("<tr bgcolor=" & sRowColor &"><td>Creationdate:</td><td>"&datCreationDate&"<input type=hidden name=datCreationdate value="&datCreationdate&"></td></tr>")	Response.Write("<tr bgcolor=" & sRowColor &"><td>Updatedate:</td><td>" &datUpdatedate& "<input type=hidden name=datUpdatedate value=" &datUpdatedate& "></td></tr>")	Response.Write("<tr bgcolor=" & sRowColor &"><td>Begineffdate:</td><td><input size=20 name=datBegineffdate value=" & Chr(34) & datBegineffdate & Chr(34) & "></td></tr>")	Response.Write("<tr bgcolor=" & sRowColor &"><td>Endeffdate:</td><td><input size=20 name=datEndeffdate value=" & Chr(34) & datEndeffdate & Chr(34) & "></td></tr>")	'Response.Write("<tr bgcolor=" & sRowColor &"><td>Userid:</td><td><input size=20 name=lngUserid value=" & Chr(34) & lngUserid & Chr(34) & "></td></tr>")	'Response.Write("<tr bgcolor=" & sRowColor &"><td>Approved:</td><td><input size=20 name=strApproved value=" & Chr(34) & strApproved & Chr(34) & "></td></tr>")	Response.Write("<tr bgcolor=" & sRowColor &"><td>User:</td><td>")	If Session("userlevel") = ADMIN Then	    BuildDropDown "user", "SELECT UserID, Login as label from User order by login", ADMINID	Else		Response.Write("<input type=hidden name=userid value = " & Session("userid") & " > ")		Response.Write(GetName("user", "login", Session("userid"))) 	End If 'Session("userlevel") = ADMIN	Response.Write("</td></tr>")	'APPROVED		Response.Write("<tr bgcolor=" & sRowColor &"><td>Approved:</td><td>" & ApprovedText(strApproved))	If Session("userlevel") = ADMIN Then		If strApproved = APPROVED Then			Response.Write("<INPUT TYPE=CHECKBOX NAME=approved VALUE=" & APPROVED & " CHECKED >")		Else			Response.Write("<INPUT TYPE=CHECKBOX NAME=approved VALUE=" & APPROVED & ">")		End If	Else		Response.Write("<INPUT TYPE=HIDDEN NAME=approved VALUE=" & NOTAPPROVED & " >")	End If 'Session("userlevel") = ADMIN 	Response.Write("</td></tr>")	Response.Write("<tr bgcolor=" & sRowColor &"><td colspan=2>News Blurb:<br>")	Response.Write("<textarea name=newsblurb rows=4 cols=80>"&strNewsBlurb&"</textarea></td></tr>")		'NEWSBODY	Response.Write("<tr bgcolor=" & sRowColor &"><td colspan=2>News Body:<br>")	Response.Write("<textarea name=newsbody rows=20 cols=80>"&strNewsBody&"</textarea></td></tr>")				Response.Write("</table><p>")	Response.Write("<input type=submit name=action value=Update>")	Response.Write("</form>")	Response.Write("</blockquote>")End Sub''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub ValidateData()	localNewsID = Request.Form("localNewsID")			'Response.Write("<h1>"&localNewsID&"</h1>")	'Response.Write("<h1>hello"&localNewsID&"</h1>")	'localNewsID = localNewsID	strFilename = Request.Form("strFilename")	strName = Request.Form("strName")	strNewsTitle = strName	strCategory = Request.Form("CategoryID")	datCreationdate = Request.Form("datCreationdate")	datUpdatedate =  Date & " " & Time	datBegineffdate = Request.Form("datBegineffdate")	datEndeffdate = Request.Form("datEndeffdate")	lngUserid = Request.Form("userid")	strApproved = Request.Form("approved")	strNewsBody = Request.Form("newsbody")	strNewsBlurb = Request.Form("newsblurb")	lngPriority = Request.Form("priority")	If localNewsID = "" Then		sError = sError & "Newsid is a required field.<br>"	End If '	If strFilename = "" Then'		sError = sError & "Filename is a required field.<br>"'	End If 	If strCategory = "" Then		sError = sError & "Category is a required field.<br>"	End If 	If datCreationdate <> "" Then		If Not IsDate(datCreationdate) Then			sError = sError & "Creationdate is not a valid date.<br>"		End If 	End If 	If datUpdatedate <> "" Then		If Not IsDate(datUpdatedate) Then			sError = sError & "Updatedate is not a valid date.<br>"		End If 	End If 	If datBegineffdate <> "" Then		If Not IsDate(datBegineffdate) Then			sError = sError & "Begineffdate is not a valid date.<br>"		End If 	End If 	If datEndeffdate <> "" Then		If Not IsDate(datEndeffdate) Then			sError = sError & "Endeffdate is not a valid date.<br>"		End If 	End If 	If lngUserid = "" Then		sError = sError & "Userid is a required field.<br>"	End If 	If strApproved = "" Then		sError = sError & "Approved is a required field.<br>"	End If 	If sError <> "" Then		DisplayForm()		Response.End	Else		Set objRS = Server.CreateObject("ADODB.Recordset")'		Response.Write("<h1>"&localNewsID&"</h1>")		If localNewsID = 0 Then			objRS.open "News", objDB, adOpenKeyset, adLockOptimistic			objRS.AddNew			objRS("UpdateDate") = Date & " " & Time			objRS("CreationDate") = Date & " " & Time			strFileName = 	Year(Date)& _ 							Right("00"&Month(Date),2)& _							Right("00"&Day(Date),2)& _							Right("00"&Hour(Time),2)& _							Right("00"&Minute(Time),2)& _ 							Right("00"&Second(Time),2)&".txt"			objRS("Filename") = strFileName		Else			objRS.open "select * from News where Newsid = " & localNewsID, _			objDB, adOpenKeyset, adLockOptimistic		End If		'objRS("UpdateDate") = Date & " " & Time		objRS("name") = strName		objRS("Catagory") = strCategory		'objRS("Creationdate") = datCreationdate		objRS("Updatedate") = datUpdatedate		objRS("Begineffdate") = datBegineffdate		objRS("Endeffdate") = datEndeffdate		objRS("Userid") = lngUserid		objRS("Approved") = strApproved		objRS("Priority") = lngPriority		objRS.Update		WriteNewsFile(strFileName)					If Err = 0 Then		'if we get here without an error, the data was updated...			Response.Write("<font color=red>" & sError & "</font><p>")						Response.Write("<table width=100% >")			If localNewsID = 0 Then				Response.Write("Thank you for creating a new News Article. We will be in touch with you in the next few days to confirm this information before adding it to SwingHomeChicago.com.  If you have any questions, please feel free to email us at <a href=mailto:admin@swinghomechicago.com>admin@swinghomechicago.com</a>.<p>")			End If			Response.Write("The following data was updated successfully:")			WriteTableRow "FIELD", "DATA", HEADING			WriteTableRow "Name:", strName, ""			WriteTableRow "Category:", GetName("Category", "name", strCategory), ""			WriteTableRow "Priority:", lngPriority, ""			WriteTableRow "Creatation Date:", datCreationDate, ""			WriteTableRow "Update Date:", datUpdateDate, ""			WriteTableRow "BeginEffDate:", datBeginEffDate, ""			WriteTableRow "EndEffDate:", datEndEffDate, ""			WriteTableRow "Name:", strName, ""			WriteTableRow "UserID:",GetName("User", "login", lngUserid) &  " (" & lngUserID & ")"  , ""			WriteTableRow "Approved:", ApprovedText(strApproved) , ""			WriteTableRow "News Title:", strNewsTitle , ""			WriteTableRow "News Blurb:", "<i>"&strNewsBlurb&"</i>" , ""			WriteTableRow "News Body:", strNewsBody , ""			Response.Write("</table>")			Response.Write("<p> <a href=edit.asp>Return to Edit Page</a>")				Response.End		Else 	 	objRS.Close			objDB.Close		End If	End IfEnd Sub''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub WriteNewsFile(strFileName)	Dim objFSO	Dim objNewsFile		Set objFSO = CreateObject("Scripting.FileSystemObject")	Response.Write("<br>Writing : "& strFilePath&strFileName & "<br>")	Set objNewsFile = objFSO.CreateTextFile(strFilePath&strFileName)	objNewsFile.WriteLine(strNewsTitle)	objNewsFile.WriteLine("")	objNewsFile.WriteLine(strNewsBlurb)	objNewsFile.Write(strNewsBody)End Sub 'WriteNewsFile''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Dim sActionsAction = lcase(Request("action"))localNewsID = Request.Form("newsID")If localNewsID = 0 or localNewsID = "" Then	localNewsID = 0End IfSet objDB = Server.CreateObject("ADODB.Connection")objDB.Open DATABASEIf lcase(Request.Form("action")) = "delete news" Then	Response.Redirect("delete.asp?action=request&table=news&recordid=" & localNewsID)End If%><!-- #include file="../include/top.txt" --><%Set objFSO = CreateObject("Scripting.FileSystemObject")strFilePath = Server.Mappath(".")& "\" & NEWS_DIRECTORY'Response.Write("<br>"&strFilePath&"<br>")If sAction = "edit news" Then	GetData()	DisplayForm()Elseif sAction = "update" Then	ValidateData()Else	datBeginEffDate = Date	datEndEffDate = DateAdd("m", 2, Date)	DisplayForm()	End If%><!-- #include file="../include/newbottom.txt" -->