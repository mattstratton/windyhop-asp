<% Option Explicit Server.ScriptTimeout = 100000Response.Expires = 0%><%Dim strTitleDim strContext	'Where we areIf Session("Tab") = "" Then	strContext = "SHC"Else	strContext = Session("Tab")	If strContext = "SS" Then		strContext = "SSU"	End IfEnd IfstrTitle = "Windyhop View Photos Page"%><!-- #include file="../include/libphoto.inc" --><!-- #include file="../include/newtop.txt" --><!-- #include file="../include/hasrights.inc" --><%'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''BEGIN AREA TO DISABLE PHOTOS'' To enable/disable photos, change bDisablePhotos'	TRUE = disabled'	FALSE = enabled''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Dim bDisablePhotosbDisablePhotos = FALSEIf bDisablePhotos Then	%>	<h1>Photo Gallery Down</h1>		Due to the high volume we have had on the photo gallery, 	this area is down until further notice.  We regret any inconvenience.	<%	Response.EndEnd If'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''END AREA TO DISABLE PHOTOS''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' Initialize VariablesDim strViewType	'Determines if this is the individual page or if it's the table viewDim tempSQL	'SQL commandsDim objDB	'Datbase objectDim objRS	'Recordset objectstrViewType = Request("type")Sub DrawPhotoPage(lngPhotoID)	'Subroutine that draws the individual photo view	Dim localSQL, objRS2, lngPrevID, lngNextID		'localSQL = "Select c.CategoryID, c.TableID, p.PhotoID as PhotoID, p.name as PhotoName, p.approved, l.ID1 as ID1 from photo as p, link as l, category as c WHERE c.TableID = " & PHOTOCAT & " AND l.ID1 = c.CategoryID AND l.ID2 = PhotoID AND p.approved = '" & APPROVED & "' ORDER BY p.PhotoID"	tempSQL = "Select c.name as CategoryName, u.Login as LoginName, l.ID1 AS ID1, p.userid, FileName, ThumbNailName, p.name as Name, blurb, p.photoid as photoid from photo as p, link as l, category as c, user as u WHERE l.ID2 = p.PhotoID AND L.ID1 = c.CategoryID AND l.LinkType = 1 AND u.userid = p.userid AND p.PhotoID = " & lngPhotoID	'tempSQL = "Select  from photo WHERE PhotoID = " & lngPhotoID	Set objDB = Server.CreateObject("ADODB.Connection")	objDB.Open DATABASE	Set objRS = objDB.Execute(tempSQL)	'objRS is the object that holds the records	localSQL = "Select c.name as CategoryName, ID1, p.userid, ThumbNailName, p.name, blurb, p.approved, p.photoid as photoid from photo as p, link as l, category as c WHERE l.ID2 = p.PhotoID AND L.ID1 = c.CategoryID AND l.LinkType = 1 AND p.approved = '" & APPROVED & "' AND c.CategoryID = " & objRS("ID1") & " ORDER BY p.PhotoID"	'Set objRS2 = objDB.Execute(localSQL)	Set objRS2 = Server.CreateObject("ADODB.Recordset")	objRS2.open localSQL, objDB, adOpenStatic, adLockOptimistic	'	Response.Write(localSQL & "<p>")'	Response.Write(tempSQL)'	Do While Not objRS2.EOF'		Response.Write(objRS2("ID1") & "<br>")'		objRS2.MoveNext'	Loop'	objRS2.MoveFirst'Response.Write("<p>objRS2(CategoryID):" & objRS2("CategoryID"))'Response.Write("<p>objRS(ID1):" & objRS2("ID1"))	Do While Not objRS2.EOF		If objRS2("PhotoID") = objRS("PhotoID") Then			objRS2.MovePrevious			If Not objRS2.BOF Then				If objRS2("ID1") = objRS("ID1") Then					lngPrevID = objRS2("PhotoID")				End If			Else				lngPrevID = 0			End If			objRS2.MoveNext			objRS2.MoveNext			If Not objRS2.EOF Then				If objRS2("ID1") = objRS("ID1") Then					lngNextID = objRS2("PhotoID")				End If			Else				lngNextID = 0			End If			Exit Do		End If		objRS2.MoveNext	Loop	%>	&nbsp;<p>	<center>	<font size = -1 face = "arial">	<% If lngPrevID <>0 Then		%>		<A href = "viewphotos.asp?view=page&photoid=<%=lngPrevID%>">Previous Photo</a>		&nbsp;|&nbsp;		<%		End If	%>	<A href = "viewphotos.asp?view=table&intCatID=<%=objRS("ID1")%>"><%=objRS("CategoryName")%></a>	<% If lngNextID <>0 Then			%>		&nbsp;|&nbsp;		<A href = "viewphotos.asp?view=page&photoid=<%=lngNextID%>">Next Photo</a>		<%		End If	%>	<p>		<h2 class = <%=strContext%>>			<%			If objRS("Blurb") = "" Then				Response.Write(objRS("Name"))			Else					Response.Write(objRS("Blurb"))			End If			%>	</h2>	<p>	<img src = "<%=objRS("FileName")%>">	<p>			<%=objRS("Blurb")%>	<p>	Posted by <a href = "http://www.windyhop.org/cgi-bin/ubbmisc.cgi?action=getbio&UserName=<%=objRS("LoginName")%>" target=_blank><%=objRS("LoginName")%></a>	<%		If Session("UserID") <> "" Then			If objRS("UserID") = cint(Session("UserID")) OR HasRights("photoadmin",Session("UserLevel")) = TRUE Then			%>				<p>				<a href = "editphotos.asp?type=edit&photoid=<%=objRS("PhotoID")%>">Edit This Image</a>				<%			End If	'If userid matches		End If	'If userid is valid		%>			<p>	<% If lngPrevID <>0 Then		%>		<A href = "viewphotos.asp?view=page&photoid=<%=lngPrevID%>">Previous Photo</a>		&nbsp;|&nbsp;		<%		End If	%>	<A href = "viewphotos.asp?view=table&intCatID=<%=objRS("ID1")%>"><%=objRS("CategoryName")%></a>	<% If lngNextID <>0 Then			%>		&nbsp;|&nbsp;		<A href = "viewphotos.asp?view=page&photoid=<%=lngNextID%>">Next Photo</a>		<%		End If	%>	</font>	</center>	<%	objRS.Close	objRS2.Close	objDB.CloseEnd Sub	'DrawPhotoPageSub DrawPhotoTable(intCatID)	'Subroutine that draws the larger table view of multiple photos		'tempSQL = "Select * from photo WHERE approved = '1' ORDER BY PhotoID"	tempSQL = "Select c.name as CategoryName, ID1, p.userid, ThumbNailName, p.name, blurb, p.approved, p.photoid as photoid from photo as p, link as l, category as c WHERE l.ID2 = p.PhotoID AND L.ID1 = c.CategoryID AND l.LinkType = 1 AND p.approved = '" & APPROVED & "' AND c.CategoryID = " & intCatID & " ORDER BY p.PhotoID"	Set objDB = Server.CreateObject("ADODB.Connection")	objDB.Open DATABASE	Set objRS = objDB.Execute(tempSQL)	'objRS is the object that holds the records	Dim x	'Counter	x = 1	If Not objRS.EOF Then		Response.Write("<h1 class = " & strContext & ">" & objRS("CategoryName") & "</h1>")	Else		Response.Write ("There are no images in this category. Sorry!")	End If	Response.Write("<table border = 0 align = center>")	Do While Not objRS.EOF		If x = 1 Then			Response.Write("<tr>")		End If		%>		<td width = 200 align = center> 			<a href = "viewphotos.asp?view=page&photoid=<%=objRS("PhotoID")%>"><img src = "<%=objRS("ThumbNailName")%>"></a>			<br>			<%			If objRS("Blurb") = "" Then				Response.Write(objRS("Name"))			Else					Response.Write(objRS("Blurb"))			End If			%>		<br>		</td>		<%		If x = 3 Then			Response.Write("</tr>")			x = 1		Else			x = x + 1		End If		objRS.MoveNext	Loop	objRS.Close	objDB.Close	Response.Write("</table>")End Sub	'DrawPhotoTableSub DisplayCategories()	%>	<center>	<a href = "/shc/uploadphotos.asp">Upload Photos</a>	<%If Session("UserID") <> "" Then%>		&nbsp;|&nbsp;<a href = "/shc/editphotos.asp">Edit My Photos</a>	<%End If%>	</center>	<h1 class = <%=strContext%>>PHOTO GALLERY</H1>	Welcome to the Windyhop Photo Gallery. Below is a list of the categories in our Gallery, as well as the number of images in each one. Just click on a category name to view the photos within!<p>	<%	tempSQL = "Select count(p.photoid) as count, c.name as CategoryName, c.categoryid as CategoryID " &_			"FROM category as c, link as l, photo as p " &_			"WHERE c.approved = '" & APPROVED & "" &_			"' AND c.tableid = " & PHOTOCAT & "" &_			" AND l.id1 = c.categoryid " &_			" AND p.approved = '" & APPROVED & "'" &_			" AND l.id2 = p.photoid "&_			"GROUP BY c.categoryid, c.name " &_			"ORDER BY c.name"	'tempSQL = "Select name, approved, categoryid, tableid FROM category WHERE approved = '" & APPROVED & "' AND tableid = " & PHOTOCAT	'tempSQL = "Select * from Category WHERE TableID = 2"	'Response.Write(tempSQL)	Set objDB = Server.CreateObject("ADODB.Connection")	objDB.Open DATABASE	Set objRS = objDB.Execute(tempSQL)	'objRS is the object that holds the records	Do While Not objRS.EOF		%>		<A href = "viewphotos.asp?view=table&intCatID=<%=objRS("categoryID")%>"><%=objRS("CategoryName")%></a> (<%=objRS("Count")%> Photos)<br>		<%		objRS.MoveNext	Loop	objRS.Close	objDB.CloseEnd Sub	'DisplayCategoriesSub Main()	strViewType = Request("view")	Select Case strViewType		Case "page"			DrawPhotoPage(Request("photoid"))		Case "table"			DrawPhotoTable(Request("intCatID"))		Case Else			DisplayCategories()	End SelectEnd Sub	'MainMain()%><!-- #include file="../include/newbottom.txt" -->