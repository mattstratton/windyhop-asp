<%'option explicitDim objDBDim objRS%><!-- #include file="../include/globalc.inc" --><% Sub UpdateData(localPhotoId,strFileName,strThumbNailName,strCaption)	Set objRS = Server.CreateObject("ADODB.Recordset")	If localPhotoID = 0 Then			objRS.Open "photo", objDB, adOpenKeyset, adLockOptimistic			objRS.AddNew			objRS("UpdateDate") = Date & " " & Time			objRS("CreationDate") = Date & " " & Time			objRS("Filename") = "/images/photos/unapproved/" & strFileName			objRS("ThumbNailName") = "/images/photos/unapproved/" & strThumbNailName	Else			objRS.open "select * from Photo where Photoid = " & localPhotoID, _			objDB, adOpenKeyset, adLockOptimistic	End If	'objRS("UpdateDate") = Date & " " & Time	objRS("name") = strFileName	objRS("Blurb") = strCaption	'objRS("Creationdate") = datCreationdate	objRS("Updatedate") = datUpdatedate	objRS("Userid") = lngUserid	objRS("Approved") = strApproved	objRS.Update	objRS.Close	objDB.CloseEnd Sub	'UpdateData' Set up some variblesDim mySmartUploadDim strModestrMode = Request.Querystring("mode")strNumberToUpload = Request.Querystring("number")Function GetImageHeight(strFilePath)	Set Image = Server.CreateObject("AspImage.Image")	Image.LoadImage(Server.MapPath(strFilePath))	GetImageHeight = Image.MaxY	Set Image = NothingEnd FunctionFunction GetImageWidth(strFilePath)	Set Image = Server.CreateObject("AspImage.Image")	Image.LoadImage(Server.MapPath(strFilePath))	GetImageWidth = Image.MaxX	Set Image = NothingEnd FunctionSub CreateThumb(strImageName,strThumbName)	Const MINPIXELS = 100	'*** creat thumbnail image	Set Image = Server.CreateObject("AspImage.Image")	Image.LoadImage(Server.MapPath("/images/photos/unapproved/" & strImageName))	ImageHeight = Image.MaxY	ImageWidth = Image.MaxX	'*** calculate aspect ratio based on MINPIXELS	If ImageHeigh > ImageWidth Then	    NewHeight = Cint(ImageHeight*MINPIXELS/ImageWidth)		NewWidth = MINPIXELS	Else		NewWidth = Cint(ImageWidth*MINPIXELS/ImageHeight)	    NewHeight = MINPIXELS	End If	'intDotPosition = InStrRev(strImageName,".")	'strThumbName = Mid(strImageName,1,intDotPosition - 1) & "_small." & Mid(strImageName,intDotPosition + 1)	Image.FileName = Server.MapPath("/images/photos/unapproved/" & strThumbName)	'Response.Write("Success!")	Image.ImageFormat = 1	Image.JPEGQuality = 70	Image.Resize NewWidth,NewHeight	Image.SaveImage	Set Image = NothingEnd Sub	'CreateThumbSub CreateThumbs(strImageName)	Response.Write(strImageName)	Set Image = Server.CreateObject("AspImage.Image")	Image.LoadImage(Server.MapPath("/images/photos/unapproved/" & strImageName))	strLocation = "/images/photos/unapproved/" & strImageName & "_small.jpg"	Image.FileName = Server.MapPath(strLocation)	Image.ImageFormat = 1	Image.JPEGQuality = 70	Image.Resize 150,188	Image.SaveImage	Set Image = NothingEnd Sub	'CreateThumbSub DisplayPhotosEnd Sub	'DisplayPhotosSub SelectPhotos	If strNumberToUpload = "" Then		strNumberToUpload = 3	End If	%>	<form name = "buttons">	Specify the number of pictures you want to upload (1&#150;36):&nbsp;</FONT>	<SELECT NAME="numBtns" SIZE="1" onchange="window.location.href = 'photos.asp?mode=SelectPhotos&number=' + numBtns.value">	<OPTION VALUE="1">1	<OPTION VALUE="2">2	<OPTION SELECTED VALUE="3">3	<OPTION VALUE="4">4	<OPTION VALUE="5">5	<OPTION VALUE="6">6	<OPTION VALUE="7">7	<OPTION VALUE="8">8	<OPTION VALUE="9">9	<OPTION VALUE="10">10	<OPTION VALUE="11">11	<OPTION VALUE="12">12	<OPTION VALUE="13">13	<OPTION VALUE="14">14	<OPTION VALUE="15">15	<OPTION VALUE="16">16	<OPTION VALUE="17">17	<OPTION VALUE="18">18	<OPTION VALUE="19">19	<OPTION VALUE="20">20	<OPTION VALUE="21">21	<OPTION VALUE="22">22	<OPTION VALUE="23">23	<OPTION VALUE="24">24	<OPTION VALUE="25">25	<OPTION VALUE="26">26	<OPTION VALUE="27">27	<OPTION VALUE="28">28	<OPTION VALUE="29">29	<OPTION VALUE="30">30	<OPTION VALUE="31">31	<OPTION VALUE="32">32	<OPTION VALUE="33">33	<OPTION VALUE="34">34	<OPTION VALUE="35">35	<OPTION VALUE="36">36	</SELECT>	</form>	<form method = "post" action = "photos.asp?mode=PhotoUpload&category=unfiled" ENCTYPE="multipart/form-data">	<input type = "hidden" name = "mode" value = "PhotoUpload">	<% 	For x = 1 to strNumberToUpload	%>	File to upload: <INPUT TYPE="FILE" NAME="FILE<%=x%>" SIZE="50"><BR>	<%	next	%>	<p>	<input type = "submit">	</form>	<%End Sub	'SelectPhotos''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub PhotoUpload	Set objDB = Server.CreateObject("ADODB.Connection")	objDB.Open DATABASE	%>	<table border = 2 align = "center">	<%	Set mySmartUpload = Server.CreateObject("aspSmartUpload.SmartUpload")	mySmartUpload.Upload	For x = 1 to mySmartUpload.files.count		If Not mySmartUpload.Files.Item(x).IsMissing Then			strFileName = mySmartUpload.Files.Item(x).FileName			intDotPosition = InStrRev(strFileName,".")			strFileName = Mid(strFileName,1,intDotPosition - 1) & "-" & Year(Now) & Month(Now) & Day(Now) & Hour(Now) & Minute(Now) & Second (Now) & "." & Mid(strFileName,intDotPosition + 1)			intDotPosition = InStrRev(strFileName,".")			strThumbName = Mid(strFileName,1,intDotPosition - 1) & "_small." & Mid(strFileName,intDotPosition + 1)			'response.write("Number of Files = " & mySmartUpload.files.count & "<br>")			'response.write("File Name = " & strFileName & "<br>")			mySmartUpload.files.item(x).saveas ("/images/photos/unapproved/" & strFileName) 			CreateThumb strFileName,strThumbName			UpdateData 0,strFileName,strThumbNailName,""			%>			<tr>			<td align = "center">			<% ImageHeight = (GetImageHeight("/images/photos/unapproved/" & strFileName) + 50)			If ImageHeight > 480 Then 				ImageHeight = 480			End If			ImageWidth = (GetImageWidth("/images/photos/unapproved/" & strFileName)+50)			If ImageWidth > 640 Then				ImageWidth = 640			End If			%>			<a href = "javascript:winopen('/images/photos/unapproved/<%=strFileName%>',<%=ImageWidth%>,<%=ImageHeight%>)"><img src = "/images/photos/unapproved/<%=strThumbName%>" width = <%=GetImageWidth("/images/photos/unapproved/" & strThumbName)%> height = <%=GetImageHeight("/images/photos/unapproved/" & strThumbName)%>></a>			</td>			<td>			<table border = 0>			<tr>			<td align = "right" valign = "top">Image Name:</td>			<td align = "left" valign = "top"><input type = "text" name = "ImageName<%=x%>" value = <%=strFileName%>></td>			</tr>			<tr>			<td align = "right" valign = "top">Description:</td>			<td align = "left" valign = "top"><textarea name = "ImageDesc<%=x%>" ROWS=4 COLS=45 WRAP="VIRTUAL"></TEXTAREA></td>			</tr>			</table>			</td>			</tr>			<%		End If	next	%>	<tr>	<td colspan = 2 align = center>	Category for these images:	<select name = "category">	<option>Dances	<option>Exchanges	<option>Vintage	<option>New Category	</select>	<br>	If you said "New Category" above, enter the name here: <input type = "text" name = "category">	<p>	<input type = "submit" value = "submit">	</td>	</tr>	</table>	<%End Sub	'PhotoUpload%><HTML><HEAD><TITLE>Photo Uploader</TITLE><script language = "JavaScript"><!--	function winopen(url,width,height) { var MainWindow = window.open(url,"_blank","toolbar=no,location=no,menubar=no,scrollbars=yes,width=" + width + ",height=" + height + ",resizeable=no,status=no");}function changeBtnCount(){	window.location.href = "photos.asp?mode=DisplayPhotos?number=" + number}//--></script></HEAD><BODY BGCOLOR="#FFFFFF"><%Select Case strModeCase "PhotoUpload"	PhotoUploadCase Else	SelectPhotos	'UpdateData 0,strFileName,strThumbNailName,""End Select%></BODY></HTML>