<% Option Explicit Server.ScriptTimeout = 100000Response.Expires = 0%><%Dim strTitlestrTitle = "Windyhop Edit Photos Page"%><!-- #include file="../include/libcat.inc" --><!-- #include file="../include/libphoto.inc" --><!-- #include file="../include/newtop.txt" --><!-- #include file="../include/hasrights.inc" --><%'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''BEGIN AREA TO DISABLE PHOTOS'' To enable/disable photos, change bDisablePhotos'	TRUE = disabled'	FALSE = enabled''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Dim bDisablePhotosbDisablePhotos = FALSEIf bDisablePhotos Then	%>	<h1>Photo Gallery Down</h1>		Due to the high volume we have had on the photo gallery, 	this area is down until further notice.  We regret any inconvenience.	<%	Response.EndEnd If'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''END AREA TO DISABLE PHOTOS''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Dim strEditTypeDim objDBDim tempSQLDim lngPhotoIDDim objRSSub DisplayCategories(intCatID)	Dim localSQL	Dim objLocalDB	Dim objLocalRS	localSQL = "Select CategoryID,Name from Category WHERE TableID = 2 AND Approved = '1'"	Set objLocalDB = Server.CreateObject("ADODB.Connection")	objLocalDB.Open DATABASE	Set objLocalRS = objLocalDB.Execute(localSQL)	'objRS is the object that holds the records	Do While Not objLocalRS.EOF		%>		<option value = <%=objLocalRS("CategoryID")%>		<% If objLocalRS("CategoryID") = intCatID Then				Response.Write(" SELECTED ")			End If		%>				><%=objLocalRS("Name")%>		<%		objLocalRS.MoveNext	Loop	objLocalRS.Close	objLocalDB.CloseEnd Sub	'DisplayCategoriesSub EditPhotos()	Dim cSize 'Counter variable	Response.Write("Hold on...we're getting your photos for you...<p>")	If Request("uploaded") = "y" Then		%>		Thanks for uploading your photos! Please feel free to modify the name, caption, or blurb of your photo. The more descriptive it is, the better!	<% End If %>		<p>		Remember that photos marked as "NOT YET APPROVED" will not be available in the Gallery until a Windyhop Admin approves them.		<p>	<%	Set objDB = Server.CreateObject("ADODB.Connection")	objDB.Open DATABASE	' Here we create the array that holds the categories	tempSQL = "Select CategoryID, Name, approved from Category WHERE TableID = " & PHOTOCAT & ""&_	" AND (Approved = '" & APPROVED & "' OR UserID = " & Session("UserID") & ") ORDER BY NAME"	Set objRS = objDB.Execute(tempSQL)	cSize = 0	Do While Not objRS.EOF		cSize = cSize + 1		objRS.MoveNext	Loop		objRS.MoveFirst'	Response.Write(cSize)	Dim IDArray()	Dim NameArray()	Dim ApprovedArray()	ReDim IDArray(cSize)	ReDim NameArray(cSize)	ReDim ApprovedArray(cSize)	Dim z	Dim i	z = 1	Do While Not objRS.EOF		IDArray(z) = objRS("CategoryID")		NameArray(z) = objRS("Name")		ApprovedArray(z) = objRS("Approved")		z = z + 1		objRS.MoveNext	Loop		objRS.Close	If Request("uploaded") = "y" Then	tempSQL = "Select ID1, p.UpdateDate, p.userid, ThumbNailName, p.name, blurb, p.approved, p.photoid as photoid from photo as p, link as l, category as c WHERE l.ID2 = p.PhotoID AND L.ID1 = c.CategoryID AND l.LinkType = 1 AND p.approved = '" & NOTAPPROVED & "'"	Else	tempSQL = "Select ID1, p.UpdateDate, p.userid, ThumbNailName, p.name, blurb, p.approved, p.photoid as photoid from photo as p, link as l, category as c WHERE l.ID2 = p.PhotoID AND L.ID1 = c.CategoryID AND l.LinkType = 1 AND p.approved <> '" & DELETED & "'"	End If	If Request("PhotoID") = "" Then		lngPhotoID = 0	Else		lngPhotoID = Request("PhotoID")	End If	Select Case (Request("admin"))		Case "approve"			If HasRights("photoadmin", Session("UserLevel")) Then				tempSQL = tempSQL & " AND p.Approved = '" & NOTAPPROVED & "'"				'Response.Write(tempSQL)			Else				tempSQL = tempSQL & " and p.UserID = " & Session("UserID")			End If				Case "manage"			If HasRights("photoadmin", Session("Userlevel")) Then				tempSQL = tempSQL			Else				tempSQL = tempSQL & " and p.UserID = " & Session("UserID")			End If		Case Else			If lngPhotoID = 0 Then				tempSQL = tempSQL & " and p.UserID = " & Session("UserID")			Else				tempSQL = tempSQL & " AND p.PhotoID = " & lngPhotoID			End If		End Select		If Request("uploaded") = "y" Then		tempSQL = tempSQL & " ORDER BY p.UpdateDate"	End If	'response.write(tempsql)	Dim lngRecords	Set objRS = Server.CreateObject("ADODB.Recordset")	objRS.Open tempSQL,objDB,adOpenStatic	'Set objRS = objDB.Execute(tempSQL)	If objRS.EOF Then		Response.Write("you have no photos")	Else	'Response.Write("Records Affected = " & objRS.RecordCount)	%>		<table border = 1>		<form action = "editphotos.asp?type=update" method = "post" name = "edit">		<%		Dim x	'counter		x = 1		%>		<!-- JavaScript Stuff -->		<script language = "javascript">				function popUp(){					var CatName					CatName = prompt("Enter","Stuff")					<% 					For i = 1 to objRS.RecordCount						Response.Write("document.edit.category" & i & ".length++;")						Response.Write("document.edit.category" & i & ".options[document.edit.category" & i & ".length - 1].text = CatName + ' (Unapproved)';")						Response.Write("document.edit.category" & i & ".options[document.edit.category" & i & ".length - 1].value = CatName;")					Next																%>					}				//var selectLength				//selectLength = document.edit.category<%=x%>.length				//selectLength = selectLength + 1				//document.write(selectLength)				//document.write(document.edit.category<%=x%>.options[0].text)				//document.edit.category<%=x%>.length++				//document.edit.category<%=x%>.options[8].text = "Your Mother"		</script>		<%		Do While Not objRS.EOF		%>			<input type = "hidden" name = "photoid<%=x%>" value = <%=objRS("PhotoID")%>>			<tr>			<td align = "center">				<a href = "viewphotos.asp?view=page&photoid=<%=objRS("PhotoID")%>"><img src = "<%=objRS("ThumbNailName")%>"></a>			</td>			<td>				<% If objRS("approved") = NOTAPPROVED Then				%>					<font color = "red"><B>NOT YET APPROVED</B></FONT><P>				<%				End If				%>				<!--				<b>Name:</b> <input type = "text" name = "Name<%=x%>" value = "<%=objRS("Name")%>"><br>				-->				<input type = "hidden" name = "Name<%=x%>" value = "<%=objRS("Name")%>">				<b>Caption:</b><textarea name = "Caption<%=x%>" wrap = virtual><%=objRS("Blurb")%></textarea><br>				<% 				If HasRights("photoadmin",Session("UserLevel")) Then					%>					<b>Uploaded By:</b><input type = "text" name = "userid<%=x%>" value = "<%=objRS("UserID")%>"><br>					<%					If objRS("approved") = "1" Then %>						<b>Approved?</b><INPUT TYPE=CHECKBOX NAME=approved<%=x%> VALUE="<%=APPROVED%>" CHECKED><br>						<% 					Else 					%>						<b>Approved?</b><INPUT TYPE=CHECKBOX NAME=approved<%=x%> VALUE="<%=APPROVED%>"><br>					<%					End If 						%>						<b>Delete?</b><INPUT TYPE=CHECKBOX NAME=deleted<%=x%> VALUE="<%=DELETED%>"><br>					<%					Response.Write("<br>")				Else	'HasRights("photoadmin")				%>					<input type = "hidden" name = "userid<%=x%>" value = "<%=objRS("UserID")%>">					<input type = "hidden" name = "approved<%=x%>" value = "<%=objRS("Approved")%>">				<%				End If				%>				<b>Category:</b><select Name = category<%=x%>>				<%				For z = 1 to cSize				%>				<option value = "<%=IDArray(z)%>"				<%				If IDArray(z) = objRS("ID1") Then					Response.Write(" SELECTED >")				Else					Response.Write(">")				End If				%>				<%=NameArray(z)%>				<% 				If ApprovedArray(z) = NOTAPPROVED Then					Response.Write(" (Unapproved)")				End If				'DisplayCategories(objRS("ID1")) 				Next				%>				</select>				<a href = "javascript:popUp()">New Category?</a>			</td>			</tr>			<%			x = x + 1			objRS.MoveNext		Loop	%>		<tr>		<td colspan = 2><input type = "submit" value = "submit">		</td>		</tr>		<input type = "hidden" name = "total" value = "<%=x - 1%>">		</form>		</table>	<%	End If	objRS.Close	objDB.CloseEnd Sub	'EditPhotosSub UpdatePhotos()	Dim strApproved	Dim strCatName	Dim intCatID	Set objDB = Server.CreateObject("ADODB.Connection")	objDB.Open DATABASE		'Response.Write(cint(Request("PhotoID2"))& " " & Request("Caption1") & " " &cint(Session("UserID")))		Response.Write("Total records: " & Request("total") & "<br>")		Dim x	For x = 1 to Request("total")		'Response.Write(Request("category" & x))		'Response.Write("<br>")		If IsNumeric(Request("category" & x)) Then			intCatID = Request("category" & x)			'Response.Write("category" & x & " Was Numeric<br>")			'Response.Write("It's value was " & Request("category" & x) & "<br>")		Else			'Here is where the string stripping should occur			strCatName = Replace(Request("category" & x), "'", "")			'Response.Write("category" & x & " Was Non-Numeric<br>")			'Response.Write("It's value was " & Request("category" & x) & "<br>")			If ReturnCatID(strCatName, PHOTOCAT) = 0 Then				'Response.Write("The CatID was 0<br>")				NewCatFly strCatName,Request("UserID" & x)				intCatID = ReturnCatID(strCatName,PHOTOCAT)			Else				'Response.Write("Hello you<br>")				intCatID = ReturnCatID(strCatName, PHOTOCAT)				'Response.Write("The CatID was " & intCatID & "<br>")			End If	'<>0					End If	'IsNumeric					If Request("approved" & x) = "" Then			strApproved = "0"		Else			strApproved = Request("approved" & x)		End If	'=""		If Request("deleted" & x) = DELETED Then			strApproved = DELETED		End If		Response.Write("PhotoID: " & Request("PhotoID"& x) & "<br>")		Response.Write("UserID: " & Request("UserID" & x) & "<p>")		UpdateData cint(Request("PhotoID"& x)),"","",Request("Name" & x),Request("Caption" & x),strApproved,cint(Request("UserID" & x)),intCatID	Next	%>		<script language = "javascript">	<!--	window.location.href = "editphotos.asp"	//-->	</script>	<%End Sub	'UpdatePhotosSub CreateCategory()	%>	Here is where you create a new category. The following categories have been created:<p>	<%	'tempSQL = "Select name, approved, categoryid, tableid FROM category WHERE approved = '" & APPROVED & "' AND tableid = " & PHOTOCAT	tempSQL = "Select * from Category WHERE TableID = 2 and Approved = '" & APPROVED & "'"	Set objDB = Server.CreateObject("ADODB.Connection")	objDB.Open DATABASE	Set objRS = objDB.Execute(tempSQL)	'objRS is the object that holds the records	Do While Not objRS.EOF		Response.Write(objRS("Name") & "<br>")		objRS.MoveNext	Loop	objRS.Close	objDB.Close	%>	<form action = "editphotos.asp" method = POST>	New category name: <input type = "text" name = "strCatName" size = 25><br>	New category description: <input type = "text" name = "strCatDesc" size = 30><br>	<input type = "hidden" name = "userid" value = "<%=Session("UserID")%>">	<input type = "hidden" name = "type" value = "updatecat">	<input type = "submit">	</form>	<%End Sub	'CreateCategorySub NewCatFly(Name,UserID)	Response.Write("newcat")	Dim localSQL	Dim objLocalDB	Dim objLocalRS	Set objLocalDB = Server.CreateObject("ADODB.Connection")	objLocalDB.Open DATABASE	Set objLocalRS = Server.CreateObject("ADODB.Recordset")		objLocalRS.open "Category", objLocalDB, adOpenKeyset, adLockOptimistic		objLocalRS.AddNew		objLocalRS("Name") = Name		'objLocalRS("Description") = Request("strCatDesc")		objLocalRS("TableID") = PHOTOCAT		objLocalRS("Approved") = NOTAPPROVED		objLocalRS("UserID") = UserID		objLocalRS.Update		objLocalRS.Close	objLocalDB.CloseEnd Sub	'NewCatFlySub UpdateCategory()	Dim localSQL	Dim objLocalDB	Dim objLocalRS	Set objLocalDB = Server.CreateObject("ADODB.Connection")	objLocalDB.Open DATABASE	Set objLocalRS = Server.CreateObject("ADODB.Recordset")	If Request("total") = "" Then		objLocalRS.open "Category", objLocalDB, adOpenKeyset, adLockOptimistic		objLocalRS.AddNew		objLocalRS("Name") = Request("strCatName")		objLocalRS("Description") = Request("strCatDesc")		objLocalRS("TableID") = PHOTOCAT		objLocalRS("Approved") = NOTAPPROVED		objLocalRS("UserID") = Request("userid")		objLocalRS.Update		objLocalRS.Close	Else		Dim x		Dim intCatID		For x = 1 to Request("total")			intCatID = Request("intCatID" & x)			objLocalRS.open "select * from Category where CategoryID = " & intCatID, objLocalDB, adOpenKeyset, adLockOptimistic			objLocalRS("Name") = Request("Name" & x)			objLocalRS("Description") = Request("Desc" & x)			objLocalRs("TableID") = PHOTOCAT			objLocalRS("Approved") = Request("Approved" & x)			objLocalRS.Update			objLocalRS.Close		Next	End If	objLocalDB.CloseEnd Sub	'UpdateCategorySub EditCategory()	Dim x	'counter%>	Here are the categories, both approved and unapproved	<p>	<table border = 1>	<%	tempSQL = "Select * from Category WHERE TableID = 2 AND APPROVED < '2'"	Set objDB = Server.CreateObject("ADODB.Connection")	objDB.Open DATABASE	Set objRS = objDB.Execute(tempSQL)	'objRS is the object that holds the records	Response.Write("<table>")	%>	<th>Name</th>	<th>Description</th>	<th>Status?</th>	<form action = "editphotos.asp?type=updatecat" method = "post">	<%	Do While Not objRS.EOF		x = x + 1		%>		<tr>		<td><input type = "text" name = "Name<%=x%>" value = "<%=objRS("Name")%>"></td>		<td><input type = "text" name = "Desc<%=x%>" value = "<%=objRS("Description")%>"></td>		<td>		<select name = "Approved<%=x%>">		<option value = "1" 		<%		If objRS("Approved") = APPROVED Then			Response.Write(" SELECTED >")		Else			Response.Write(">")		End If		%>		Approved		<option value = "0" 		<%		If objRS("Approved") = NOTAPPROVED Then			Response.Write(" SELECTED >")		Else			Response.Write(">")		End If		%>		Not Approved		<option value = "2">Deleted		</select>		<input type = "hidden" name = "intCatID<%=x%>" value = "<%=objRS("CategoryID")%>">		</tr>		<%		objRS.MoveNext	Loop	objRS.Close	objDB.Close	%>	<input type = "hidden" name = "total" value = "<%=x%>">	</table>	<input type = "submit">	<%End SubSub Main()	strEditType = Request("type")	If Session("UserID") = "" Then		Response.Write("Sorry, you are not logged in. You cannot edit photos")	Else		Select Case strEditType			Case "update"				UpdatePhotos()			Case "createcat"				CreateCategory()			Case "updatecat"				UpdateCategory()			Case "editcat"				EditCategory()			Case Else				EditPhotos()		End Select	End IfEnd Sub	'MainMain()%><!-- #include file="../include/newbottom.txt" -->