<%Option ExplicitResponse.Buffer = FALSEServer.ScriptTimeout = 100000%><!-- #include file="../include/globalc.inc" --><!-- #include file="../include/debug.inc" --><!-- #include file="../include/hasrights.inc" --><%If NOT DEBUG_MODE Then%><STYLE TYPE="text/css"><!--BODY  {	font-family : Verdana, Helvetica,sans-serif;	font-size : x-small;	margin-left : 0 px;	margin-top : 0 px;}TD{    BACKGROUND-COLOR: #dcdcdc}PRE{    FONT-FAMILY: Courier;}--></STYLE><% Else %><STYLE TYPE="text/css"><!--BODY  {	font-family :Courier;	font-size : x-small;	margin-left : 0 px;	margin-top : 0 px;}TD{    BACKGROUND-COLOR: #dcdcdc}PRE{    FONT-FAMILY: Courier;}--></STYLE><%End If'<!-- #include file = "./include/top.txt" -->%><!-- #include file="../include/getonefield.inc" --><!-- #include file="../include/getname.inc" --><!-- #include file="../include/geteventset.inc" --><!-- #include file="../include/stripHTMLTag.inc" --><%' GetEventSet( 	lngBandID,'				lngVenueID,'				lngInstructorID,'				strLesson, '				strShowDJ,'				strOther, '				strWorkshop,'				datBeginDate, '				datEndDate,'				strApproved,' 				lngEventID)'Get me to Sunday!CONST CURRENT_PAGE = "zoottest.asp"Dim datStartDateDim datFinishDateDim strBodyDim strHeaderDim strFooterDim strSubjectDim strCustomMessageDim objDBDim objRSDim strSQLDim strSubscriberSQLDim LastEventDayDim CurrentEventDayCONST MAILSERVERADDRESS = "imail7.innerhost.com"Dim JMail''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub SetupJmail()		If Request.ServerVariables("SERVER_NAME")= "localhost" Then		Exit Sub	End If	Set JMail = Server.CreateObject("SMTPsvg.Mailer") '("JMail.SMTPMail") 		'JMail.Logging = TRUE	'JMail.Log "jmail.log"			' This is my local SMTP server	'JMAIL VERSION	'JMail.ServerAddress = MAILSERVERADDRESS 	'NOT Jmail	JMail.RemoteHost = MAILSERVERADDRESS 		' This is me....	JMail.FromName = "Windyhop"	JMail.FromAddress = "swingbot@windyhop.org"	'JMail.AddRecipient "Windyhop", "zoot@windyhop.org"	'JMail.SMTPLog = "./smtp." & Year(Date()) & Month(Date()) & _	'		Day(Date()) & Hour(Time()) & Minute(Time()) & ".log"	'JMail.SMTPLog = "smtp.log"		JMail.Subject = "Windyhop Test. Please Ignore" 'Session("strSubject")	JMail.BodyText = "We have been having trouble with our email system, and currently are running some tests. " & _		" We are sorry for this inconvenience.  Thanks for your patience."End Sub 'SetupJMail()''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function FormatEvent(strDate, strEventName, strBandName, strVenueName, strVenueAddress1, strVenueCity, strVenueState, strLessonTime,strShowTime, strEndTime, strAge, strPrice, strEventNote1, strEventNote2)	Dim strTemp	strTemp = strTemp &  Month(strDate)&"/"&Day(strDate)&" - "	strTemp = strTemp &  Ucase(strEventName&" @ "&strVenueName)& vbcrlf	If strEventName <> strBandName Then		strTemp = strTemp & "Featuring " & strBandName & vbcrlf	End If	strTemp = strTemp & strVenueAddress1 & " - " & strVenueCity & ", " & strVenueState & vbcrlf	If strLessonTime <> "" Then		strTemp = strTemp & "Lesson " & strLessonTime & ", "	End If		strTemp = strTemp &  "Show " & strShowTime	If strEndTime <> "" Then		strTemp = strTemp & " - " & strEndTime	End IF 	strTemp = strTemp & vbcrlf	If strAge <> "" Then		strTemp = strTemp & strAge & " - "	End If		strTemp = strTemp & strPrice & vbcrlf	If strEventNote1 <> "" Then		strTemp = strTemp &  ChopToWidth(strEventNote1,ZOOT_WIDTH) & vbcrlf		'strTemp = strTemp & strEventNote1 & vbcrlf	End If		If strEventNote2 <> "" Then		strTemp = strTemp &  ChopToWidth(strEventNote2, ZOOT_WIDTH) & vbcrlf	End If	strTemp = strTemp &  vbcrlf		FormatEvent = strTempEnd Function 'FormatEvent()''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function FormatWorkshop(strDate, strEventName, strVenueName, strVenueAddress1, strVenueCity, strVenueState, strLessonTime,strEndTime, strAge, strPrice, strEventNote1, strEventNote2)	Dim strTemp	strTemp = strTemp &  Month(strDate)&"/"&Day(strDate)&" - "	strTemp = strTemp &  Ucase(strEventName&" @ "&strVenueName)& vbcrlf		strTemp = strTemp & strVenueAddress1 & " - " & strVenueCity & ", " & strVenueState & vbcrlf	If strLessonTime <> "" Then		strTemp = strTemp & "Time: " & strLessonTime & " - " & strEndTime	End If		strTemp = strTemp & vbcrlf	If strAge <> "" Then		strTemp = strTemp & strAge & " - "	End If		strTemp = strTemp & strPrice & vbcrlf	If strEventNote1 <> "" Then		strTemp = strTemp &  ChopToWidth(strEventNote1,ZOOT_WIDTH) & vbcrlf		'strTemp = strTemp & strEventNote1 & vbcrlf	End If		If strEventNote2 <> "" Then		strTemp = strTemp &  ChopToWidth(strEventNote2, ZOOT_WIDTH) & vbcrlf	End If	strTemp = strTemp &  vbcrlf		FormatWorkshop = strTempEnd Function 'FormatWorkshop()''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function BuildBody(strEventType,lngBandID,lngVenueID,lngInstructorID,strLesson, strShowDJ, strOther, strWorkshop,datBeginDate, datEndDate)	Dim strFormattedEvent	GetEventSet lngBandID,lngVenueID,lngInstructorID,strLesson, strShowDJ, strOther, strWorkshop,datBeginDate, datEndDate, "", ""	'GetEventSet "","","", "", YES, "", "", datSrtDate, datEndDate,"",""		LastEventDay = 0	CurrentEventDay = Weekday(objRSEvent("Date"))			While Not objRSEvent.EOF 		CurrentEventDay = Weekday(objRSEvent("Date"))		If LastEventDay <> CurrentEventDay Then			BuildBody = BuildBody & WeekdayName(Weekday(objRSEvent("Date")))&", "&MonthName(Month(objRSEvent("Date")))&" "&Day(objRSEvent("Date"))&", "&Year(objRSEvent("Date"))&vbcrlf			BuildBody = BuildBody & "------------------------------------"&vbcrlf		End If		'strEventType, _ 		If strEventType = "Workshop" Then			strFormattedEvent = FormatWorkshop(objRSEvent("Date"), _										    objRSEvent("EventName"), _ 											objRSEvent("VenueName"), _											objRSEvent("VenueAddress1"), _ 											objRSEvent("VenueCity"), _											objRSEvent("VenueState"), _											objRSEvent("LessonTime"), _											objRSEvent("EndTime"), _											objRSEvent("Age"), _											objRSEvent("Price"), _											objRSEvent("EventNote1"), _ 											objRSEvent("EventNote2") _										   )		Else			strFormattedEvent = FormatEvent(objRSEvent("Date"), _										    objRSEvent("EventName"), _ 											objRSEvent("BandName"), _											objRSEvent("VenueName"), _											objRSEvent("VenueAddress1"), _ 											objRSEvent("VenueCity"), _											objRSEvent("VenueState"), _											objRSEvent("LessonTime"), _											objRSEvent("ShowTime"), _											objRSEvent("EndTime"), _											objRSEvent("Age"), _											objRSEvent("Price"), _											objRSEvent("EventNote1"), _ 											objRSEvent("EventNote2") _										   )		End If				BuildBody = BuildBody & strFormattedEvent				LastEventDay = Weekday(objRSEvent("Date"))		objRSEvent.MoveNext	WendEnd Function''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function BuildFooter()	Dim strTemp	Dim fso	Dim fZootBottom	Set fso = CreateObject("Scripting.FileSystemObject")	'Response.Write(Server.MapPath(".") & "\..\include\zootbottom.inc")	Set fZootBottom = fso.OpenTextFile(Server.Mappath(".") & "\..\include\zootbottom.txt")	BuildFooter = strHorLine & vbCrlF & ChopToWidth(fZootBottom.ReadAll,ZOOT_WIDTH)	Set fso = Nothing	Set fZootBottom = Nothing	End Function''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function CenterText(strString, strWrap)	Dim iNumOfSpaces	Dim iNumLeft, iNumRight	Dim bolWrapped		if StrWrap <> "" Then bolWrapped = TRUE		If bolWrapped Then		iNumOfSpaces = (ZOOT_WIDTH-2) - Len(strString)	Else		iNumOfSpaces = (ZOOT_WIDTH) - Len(strString)	End If		iNumLeft = CInt(iNumOfSpaces/2)	' If it's odd, cut the odd space off the right	If iNumLeft*2 < iNumOfSpaces Then		iNumRight = CInt(iNumOfSpaces/2) + 1 		ElseIf  iNumLeft*2 > iNumOfSpaces Then		iNumRight = CInt(iNumOfSpaces/2) - 1	Else 		iNumRight = CInt(iNumOfSpaces/2) 	End If		'CenterText = iNumOfSpaces & "," & iNumLeft & "," & iNumRight & "," & "|" & String(iNumLeft, " ") & strString & String(iNumRight, " ") & "|"	If bolWrapped Then		CenterText = strWrap & String(iNumLeft, " ") & strString & String(iNumRight, " ") & strWrap	Else		CenterText = String(iNumLeft, " ") & strString & String(iNumRight, " ") 	End If	End Function''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function BuildHeader(datSrtDate, datEndDate)	Dim iLen	'Dim strLine	Dim strEventsIncluded		BuildHeader = strHorLine	iLen = Len(BuildHeader)	BuildHeader = BuildHeader & vbcrlf	BuildHeader = BuildHeader  & CenterText("THE ZOOT SCOOP -- powered by Windyhop", "|") & vbcrlf	BuildHeader = BuildHeader  & CenterText("""Chicago's Online Swing Community""", "|") & vbcrlf	' This logic is for padding the end of the text box with enough spaces.  Since the dates	'    are variable lengths, you can't hard code it.  -jdw 1/29/00	BuildHeader = BuildHeader & CenterText("ALL SWING GIGS EVENTS FOR: "&datSrtDate&" - "&datEndDate, "|") & vbCrlF		strEventsIncluded = "Events Included: "	If Request.Form("showdj") = YES Then		strEventsIncluded = strEventsIncluded & "Show/DJ Events" 	End If	If Request.Form("workshop") = YES Then		strEventsIncluded = strEventsIncluded & ", Workshops"	End If			BuildHeader = BuildHeader & CenterText(strEventsIncluded,"|") & vbCrlF	BuildHeader = BuildHeader & CenterText("This info is as of " & Date & ".", "|") & vbCrlF	'strLine = strLine & String(iLen-Len(strLine)-1, " ")	'BuildHeader = BuildHeader & strLine & "|"&vbcrlf	'strLine = ""	BuildHeader = BuildHeader & CenterText("Please visit www.windyhop.org", "|") & vbCrlF	BuildHeader = BuildHeader & CenterText("for current information.", "|") & vbCrlF	BuildHeader = BuildHeader & strHorLine & vbcrlf	End Function 'BuildHeader()''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' ChopToWidth(strText, iWidth) - Takes the text string passed to it, and adds a newline character after' 	the appropriate width.  Will figure out word breaks.' INPUT - strText: text string to add newline characters to.' 		  iWidth: width of lines to chop to.' OUTPUT: same text string, but with newline characters''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function ChopToWidth(strText, iWidth)	'ChopToWidth = strText	'Exit Function	Dim strTemp	Dim iCurrentChar	Dim iTemp	Dim strReturn	Dim x 	'iWidth=20	iCurrentChar = 1	Dim iCount	Dim bNewLineInString		If DEBUG_MODE THEN Response.Write("Length of String = " &len(strText) & "<br>")	If DEBUG_MODE Then Response.Write("<table border=1><tr><td colspan=2>")	If DEBUG_MODE Then Response.Write("<pre>         1         2         3         4         5         6         7         8         9         0         1         2         3         4         5         6         7         8         9         0         1         2         3         4         5         6         7         8         9         0         1         2         3         4         5         6         7         8         9         0<br>")	If DEBUG_MODE Then Response.Write     ("12345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890<br>")	If DEBUG_MODE Then Response.Write(Replace(strText,vbCrlF,"*") & "</td></tr>")	While iCurrentChar <= Len(strText)		If DEBUG_MODE Then Response.Write("<tr><td>Begin of Loop - ichar:" & iCurrentChar & "&lt;" & Mid(strText,iCurrentChar,1) & "&gt;" & Asc(Mid(strText,iCurrentChar,1))& "</td><td> " & Mid(strText,iCurrentChar) & "</td>")		'Saves from infinite loop!		x = x + 1		if x > 100 Then 			ChopToWidth = strReturn			Exit Function		End If				' 32 = newline		' 46 = .		' 13 = space		While  Asc(Mid(strText,iCurrentChar,1)) = 32 _ 			OR Asc(Mid(strText,iCurrentChar,1)) = 46 _ 			OR Asc(Mid(strText,iCurrentChar,1)) = 13  			iCurrentChar = iCurrentChar + 1		Wend		If DEBUG_MODE Then Response.Write("<tr><td>Move ichar - ichar:" & iCurrentChar & "&lt;" & Mid(strText,iCurrentChar,1) & "&gt;" & Asc(Mid(strText,iCurrentChar,1))& "</td><td> " & Mid(strText,iCurrentChar) & "</td>")			strTemp = Mid(strText, iCurrentChar, iWidth)		'If DEBUG_MODE Then Response.Write("<tr><td><b>1st Cut</td><td><b> " & Replace(strTemp,vbCrlF,"*NL*") & "</b></td>")		'If there is a newline in the current line		iTemp = InStr(strTemp, vbcrlf)		If iTemp <> 0 Then			strTemp = Mid(strText,iCurrentChar,iTemp)		'If the last character is NOT a SPACE		ElseIf Len(strTemp) < iWidth Then ' AND bNewLineInString = FALSE Then 'It's the last line in the block			If DEBUG_MODE Then Response.Write("<tr><td colspan=2>last line</td></tr>")						strTemp = strTemp 			iCurrentChar = 1000000000		ElseIf Right(strTemp,1) <> " " Then ' AND (Len(strTemp) = iWidth) Then			iTemp = InStrRev(strTemp," ")			If iTemp = 0 Then 'no spaces 1 word is the whole line				If DEBUG_MODE Then Response.Write("<tr><td colspan=2>one word</td></tr>")				strTemp = strTemp & vbCrlF			Else				If DEBUG_MODE Then Response.Write("<tr><td colspan=2>multi words</td></tr>")				strTemp = Mid(strText,iCurrentChar, iTemp) & vbCrlF			End If		Else			If DEBUG_MODE Then Response.Write("<tr><td colspan=2>else</td></tr>")			strTemp = strTemp & vbCrlF		End If				strReturn = strReturn & strTemp				If DEBUG_MODE Then Response.Write("<tr><td colspan=2>ichar = " & iCurrentChar & "len(strTemp) = " & Len(strTemp)& " </td>")				iCurrentChar = iCurrentChar + Len(Replace(strTemp,vbCrlF,""))		If DEBUG_MODE Then Response.Write("<tr><td>New ichar = " & iCurrentChar & "</td><td bgcolor=black> </td>")		If DEBUG_MODE Then Response.Write("<tr><td bgcolor=black></td><td bgcolor=black> </td>")	Wend	ChopToWidth = strReturn	If DEBUG_MODE Then Response.Write("</table>")End Function''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function BuildCustomMessage(strCustomMessage)	If strCustomMessage <> "" Then		BuildCustomMessage = ChopToWidth(strCustomMessage,ZOOT_WIDTH) & vbcrlf & strHorLine & vbcrlf	Else		BuildCustomMessage = ""	End IfEnd Function''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function BuildSubject(datSrtDate, datEndDate)	BuildSubject = "Chicago Swing Events for "&Month(datSrtDate)&"/"&Day(datSrtDate)&"-"&Month(datEndDate)&"/"&Day(datEndDate)End Function''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function SendEmailToList(tempSubject, tempBody, strSQL)	Dim objDB	Dim objRS	Dim iCount	Dim sEmailList		iCount = 0	'Dim strSQL	'On Error Resume Next	Set objDB = Server.CreateObject("ADODB.Connection")	objDB.Open DATABASE	'strSQL = "select firstname, lastname, login, email, emaillist1 from user"	Set objRS = objDB.Execute (strSQL)		While Not objRS.EOF			SetupJmail()			iCount = iCount + 1 'count the number of times it's sent out.			'JMail.AddRecipient "Windyhop", "zoot@windyhop.org"			JMail.AddRecipient "Test", "jason@jasonwyckoff.com" 'objRS("email")				JMail.Priority = 2			JMail.AddExtraHeader  "Originating-IP: " & Request.ServerVariables("REMOTE_ADDR")					Response.Write("Adding " & objRS("firstname") & " " & objRS("lastname")&" (" & _			               objRS("login")&") at "&objRS("email")&"... ")						if Jmail.SendMail then			  Response.Write "<font color=green>Mail sent</font><br>"				Response.end			else			  Response.Write "<font color=red>Mail send failure. Error was " & JMail.Response & "<br></font>"			  Response.end			end if			Set JMail = Nothing			objRS.MoveNext				Wend		'Response.Write("About to mail.sendmail<br>")		'Response.Write("Complete mail.sendmail<br>")			Set	objRS = Nothing		%>	<table border=1>	<tr><td>Total subscribers</td><td><%=Session("beforecount")%></td></tr>	<tr><td>Total sent</td><td><%=iCount%></td></tr>	</table>	<%		SendEmailToList = TRUE	End Function 'SendEmailToList''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function LogJob(datCompleteDate, datBdate, datEdate, strComment)	Set objDB = Server.CreateObject("ADODB.Connection")	objDB.Open JOBDB		Set objRS = Server.CreateObject("ADODB.Recordset")		objRS.open "Job", objDB, adOpenKeyset, adLockOptimistic    	objRS.AddNew	objRS("Name") = "zoot"	'datDate = datCompleteDate	'Response.Write(datBDate)	objRS("RunDate") = Now	objRS("Comment1") = FormatDate(datBDate)	objRS("Comment2") = FormatDate(datEdate)	objRS("Comment3") = Left(strComment,250)	objRS.Update					Set objRS = Nothing	Set objDB = Nothing		LogJob = TRUE	End Function 'LogJob()''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub DeleteJobs()		Set objDB = Server.CreateObject("ADODB.Connection")	objDB.Open JOBDB		strSQL = "Delete from job " 	'RESPONSE.WRITE(strSQL)	Set objRS = objDB.Execute(strSQL)	Set objRs = Nothing	set objDB = Nothing			End Sub ' DeleteJobs()''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function BuildForm()	%>
	<h1>Select Zoot Options</h1>	<form name=zoot action=<%=CURRENT_PAGE%> method=post>	<table border=0 cellpadding=3>	<tr>		<td>			Start Date:		</td>		<td>			<input type="text" name="startdate"  value= <%=datStartDate%>  maxlength=8 size=8> 		</td>	</tr>	<tr>		<td>			End Date: 		</td>		<td>			<input type="text" name="enddate" maxlength=8 size=8 value=<%=datEndDate%> >		</td>	</tr>	<tr>		<td colspan=2>			<input type=checkbox name=showdj value=<%=YES%> checked> Show/DJ Events		</td>	</tr>	<tr>		<td colspan=2>			<input type=checkbox name=workshop value=<%=YES%> checked> Workshops		</td>	</tr>	<tr>		<td colspan=2>			Custom Message <small>(optional)</small><br>			<textarea name=custommessage rows=5 cols=40></textarea><br>				<br>			<input type="submit" name=action value=Submit>				</form>		</td>		</tr>	</table>	<%		BuildForm = TRUEEnd Function''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub BuildJobLogTable()	CONST NUMOFRUNS = 10	Dim iCounter		Set objDB = Server.CreateObject("ADODB.Connection")	objDB.Open JOBDB		strSQL = "Select * from Job order by rundate desc " ' where name = ""zoot"" Order by Date1"	Set objRS = objDB.Execute(strSQL)		%>	<table border=1>	<tr ><td colspan=5 align=center><b>Last <%=NUMOFRUNS%> runs...</b></td></tr>	<tr><th><b>#</b></th>	<th><b>Begin</b></th><th><b>End</b></th><th><b>Date Ran</b></th>	<th><b>Type</b></th>	</tr>	<%	iCounter = 1	Do While (Not objRS.EOF) AND iCounter <= NUMOFRUNS	%>		<tr>		<td><%=iCounter%></td>		<td>		<%Response.Write(objRS("Comment1"))%>		</td>		<td>		<%Response.Write(objRS("Comment2"))%>		</td>		<td>		<%Response.Write(objRS("RunDate"))%>		</td>		<td>		<%=objRS("Comment3")%>		</td>		</tr>		<%		iCounter = iCounter + 1		objRS.MoveNext	Loop	%>	</table>		<a href=<%=CURRENT_PAGE%>?action=areyousuredelete>Delete all job records</a><%End Sub 'BuildJobLogTable()	''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function FormatDate(datDate)	FormatDate = WeekdayName(Weekday(datDate),TRUE) & ", " & MonthName(Month(datDate),TRUE)& " " & Day(datDate)&", "&Year(datDate)End Function''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub SelectRecipient()		Set objDB = Server.CreateObject("ADODB.Connection")	objDB.Open DATABASE	%>	<form name=SelectRecipient method=post action=<%=CURRENT_PAGE%>>		<input type="submit" name=submit value=Submit>	<table cellspacing="2" cellpadding="2" width=100% border="1">	<tr>		<td>			<input type="radio" name="action" value="mailoneuser">Custom User:		</td>		<td>			<input type="text" name=customuser> <small>(valid email address)</small>		</td>	</tr>	<tr>		<td>			<input type="radio" name="action" value="mailsubscribers" checked>Subscriber List		</td>		<td>	<%		strSQL=	" SELECT count(*) as count from user where EmailList1='" & YES & "'"& _				" AND password <> '" & RANDOMPASSWORD & "'" &  _				" AND password <> '" & OLDRANDOMPASSWORD & "'"		'Response.Write(strSQL)		Set objRS = objDB.Execute(strSQL)		%>		(<%=objRS("count")%> subscribers) <a href=<%=CURRENT_PAGE%>?action=viewlist target=_blank>	 View Subsriber List</a>		</td>	</tr>	<tr>		<td>	   		<input type="radio" name="action" value="mailcustom">Custom Select	   		<textarea cols=80 rows=20 name=customsql>SELECT firstname, lastname, login, email, emaillist1 	   	FROM  user 	   	WHERE EmailList1=Yes 	   	AND   (password <> 'yKoF97kwl' AND password <> 'wx4b325s') 	   	AND   ...	   		</textarea>	   	</td>	  	<td>			<%			Session("beforecount") = objRS("count")			Set objRS = Nothing			strSQL = "select firstname, lastname, login, email, emaillist1 from " & _					 " user where userlevel=" & ADMIN			Set objRS = objDB.Execute (strSQL)						While Not objRS.EOF				Response.Write(objRS("email")&"<br>")				objRS.MoveNext				Wend			Set	objRS = Nothing			%>		</td>	</tr>	</table>	<input type="submit" name=submit value=Submit></form><%End Sub 'SelectRecipient()''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub ClearSessionVariables()	Session("strBody") = ""	Session("strSubject") = ""	Session("startdate") = ""	Session("enddate") = ""	Session("beforecount") = ""	Session("aftercount") = ""End Sub''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub FormatMessage()	'Dim strInThisIssue	'strInThisIssue = "In This Issue:" & vbcrlf	'If Request.Form("showdj") = YES Then	'	strInThisIssue = strInThisIssue & "- Show/DJ Events" & vbCrlF	'End If	'If Request.Form("workshop") = YES Then	'	strInThisIssue = strInThisIssue & "- Workshops" & vbCrlF	'End If	'strInThisIssue = strInThisIssue & strHorLine & vbCrlF	If Request.Form("showdj") = YES Then		strBody = strBody & "EVENTS" & vbCrlF & String(ZOOT_WIDTH, "=") & vbCrlF		strBody = strBody & BuildBody("ShowDJ", "","","", "", YES, "", "", Request.Form("startdate"),Request.Form("enddate"))	End If		If Request.Form("workshop") = YES Then		strBody = strBody &  "WORKSHOPS" & vbCrlF & String(ZOOT_WIDTH, "=") & vbCrlF 		strBody = strBody & BuildBody("Workshop","","","", "", "", "", YES, Request.Form("startdate"),Request.Form("enddate"))	End If				strSubject = BuildSubject(Request.Form("startdate"),Request.Form("enddate"))	strHeader = BuildHeader(Request.Form("startdate"),Request.Form("enddate"))	strCustomMessage = BuildCustomMessage(Request.Form("custommessage"))	strFooter = BuildFooter()		strBody = StripHTMLTag(strBody)		strBody = strHeader & strCustomMessage & vbcrlf &  strBody & strFooter		Session("startdate") = Request.Form("startdate")	Session("enddate") = Request.Form("enddate")	Session("strBody") = strBody	Session("strSubject") = strSubject		%>	<h1> Proofread Message</h1>	Does this look good?&nbsp; &nbsp; &nbsp;<a href=<%=CURRENT_PAGE%>?action=selectrecipient >Yes, Now let me pick who to send it to!</a>&nbsp; &nbsp; &nbsp;<a href=<%=CURRENT_PAGE%>>No! Go Back!</a>	<hr>	<pre><%Response.Write("Subject: "&strSubject&vbcrlf&vbcrlf)	Response.Write(strBody)	Response.Write("</pre>")	%>	<hr>	Does this look good?&nbsp; &nbsp; &nbsp;<a href=<%=CURRENT_PAGE%>?action=selectrecipient >Yes, Now let me pick who to send it to!</a>&nbsp; &nbsp; &nbsp;<a href=<%=CURRENT_PAGE%>>No! Go Back!</a>	<%End Sub 'FormatMessage()''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub BuildMailMenu()	%>	<h1>Windyhop Mailings Menu</h1>		<a href=<%=CURRENT_PAGE%>?action=zoot>Send Out the Zoot Scoop</a><br><br>	<a href=<%=CURRENT_PAGE%>?action=custommail>Send Out a Custom Email</a><br><br>		<%End Sub''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub WriteCustomEmail()	%>	<form name=customemail action=<%=CURRENT_PAGE%>?action=submitcustomemail>	Subject: <input type=text name=subject max=100><br>	Body:<br>	<textarea name=body rows=20 cols=80>		</textarea>	</form>	<%End Sub''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub ViewSubscriberList	Set objDB = Server.CreateObject("ADODB.Connection")	objDB.Open DATABASE	Set objRS = objDB.Execute (strSubscriberSQL)	%><table border=1>	<tr><td><b>NAME</B></TD><TD><B>LOGIN</B></TD><TD><B>EMAIL</B></TD></TR>	<%		While Not objRS.EOF		%>		<tr><td><%=objRS("firstname")&" "&objRS("lastname")%></td><td><%=objRS("login")%></td><td><%=objRS("email")%></td></tr>		<%		objRS.MoveNext		Wend	%> </table> <%	Set	objRS = NothingEnd Sub''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function Main()	Dim sAction	Dim strSQL		datStartDate = Date	While Weekday(datStartDate) <> vbMonday		datStartDate = DateAdd("d",1,datStartDate)	Wend		datEndDate = DateAdd("d", 6, datStartDate)		sAction = lcase(Request.Form("action"))		If sAction = ""  Then		sAction = lcase(Request.QueryString("action"))	End If		'Response.Write("Action = " &sAction&"<br>")	strSubscriberSQL = " SELECT firstname, lastname, login, email, emaillist1 " & _			 " FROM   user where EmailList1='" & YES & "'"& _				" AND password <> '" & RANDOMPASSWORD & "'" &  _				" AND password <> '" & OLDRANDOMPASSWORD & "'"		Select Case sAction		Case "viewlist"			ViewSubscriberList()		Case "deletejobs"			DeleteJobs()			'BuildForm()		Case "areyousuredelete"			%>			Are you sure you want to delete?<br><br>			<a href=<%=CURRENT_PAGE%>?action=deletejobs>Yes! Blow them away!</a><br><br>			<a href=<%=CURRENT_PAGE%>>No! Start Over!</a><br><br>			<%		Case "submit"			'AddCustomZootMessage()		'Case "format"			FormatMessage()		Case "selectrecipient"			SelectRecipient()		Case "mailoneuser"			Dim strOneUser			strOneUser = Request.Form("customuser")						SendMail "", "admin@windyhop.org",strOneUser, Session("strSubject"),Session("strBody")			'bolError = LogJob(date,Session("startdate"),Session("enddate"),Request.Form("customuser"))				%>				<hr>				Your mail was sent to <%=strOneUser%>. <p>				<a href=<%=CURRENT_PAGE%>>Exit</a>				<%				ClearSessionVariables()		Case "mailcustom"			strSQL = Request.Form("customsql")			'strSQL = "select firstname, lastname, login, email, emaillist1 from user where userlevel = "&ADMIN			bolError = SendEmailToList(Session("strSubject"),Session("strBody"),strSQL)			If bolError = TRUE Then				'bolError = LogJob(date,Session("startdate"),Session("enddate"),"Admin")				%>				<hr>				Your mail was sent. <p>				<a href=<%=CURRENT_PAGE%>>Exit</a>				<%				ClearSessionVariables()							Else 				Response.Write("ERROR SENDING EMAIL<br>")			End If		Case "mailsubscribers"			bolError = SendEmailToList(Session("strSubject"),Session("strBody"),strSubscriberSQL)			If bolError = TRUE Then				'bolError = LogJob(date,Session("startdate"),Session("enddate"),"Subscribers")				%>				<hr>				Your mail was sent. <p>				<a href=<%=CURRENT_PAGE%>>Exit</a>				<%				ClearSessionVariables()							Else 				Response.Write("ERROR SENDING EMAIL<br>")			End If		Case "zoot"			BuildForm()			'BuildJobLogTable()		Case "writecustomemail"			WriteCustomEmail()		Case Else			ClearSessionVariables()			SendEmailToList Session("strSubject"),Session("strBody"),strSubscriberSQL	End Select		Main = TRUEEnd Function''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Dim bolErrorDim strHorLinestrHorLine = "+" & String(ZOOT_WIDTH-2, "=") & "+" ' ZOOT_WIDTH is the width of the email messageCONST ZOOT_WIDTH = 60	bolError = Main()		' <!-- #include file = "./include/bottom.txt" -->%>