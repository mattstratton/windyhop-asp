<%' Library Name: liblogin.inc' Functions Included:'     LoginFormCheck()'     WelcomeUser()'     CookieCheck()'     BuildLoginForm()'     LogUser()'     Login()''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub LoginFormCheck()	'check form to database		Dim objDB		Dim objRS		Dim strSQL		Dim DataConn	Set objDB = Server.CreateObject("ADODB.Connection")	objDB.Open DATABASE	Set objRS = Server.CreateObject("ADODB.Recordset")		strSQL = "SELECT login, password, userid, firstname, lastname, userlevel, bandidfav1, venueidfav1 " _		       & "FROM   user " _			   & " WHERE  login = '" & Request.Form("login") & "'" _			   & " AND    password = '" & Request.Form("password") & "'"	'	Response.Write(strSQL)		objRS.Open strSQL, DATABASE			If 	objRS.EOF = TRUE Then		Response.Write("Invalid login")									'BuildLoginForm()			Else		If Request.Form("writecookie") = "Y" Then			Response.Cookies("userid") = ObjRS("userid")			Response.Cookies("userid").Expires = Date+365						'Response.Cookies("UserName") = ObjRS("login")			'Response.Cookies("UserName").Expires = Date+365			'Response.Cookies("UserName").path = "/cgi-bin"						'Response.Cookies("Password") = ObjRS("password")			'Response.Cookies("Password").Expires = Date+365			'Response.Cookies("Password").path = "/cgi-bin"						'Response.Cookies("NameStorage") = "yes"			'Response.Cookies("NameStorage").Expires = Date+365			'Response.Cookies("NameStorage").path = "/cgi-bin"			'Response.Cookies("ubber2452553.0416") = Server.URLEncode(ObjRS("login") & "&" & ObjRS("password") & "&" & ObjRS("login") & "&1000&" & right("00000000" & ObjRS("userid"), 8) & "&0&0")			'Response.Cookies("ubber2452553.0416").Expires = Date+365		Else			' Write the cookie for the UBB, but these expire at end of session			'Response.Cookies("UserName") = ObjRS("login")			'Response.Cookies("UserName").path = "/cgi-bin"						'Response.Cookies("Password") = ObjRS("password")			'Response.Cookies("Password").path = "/cgi-bin"						'Response.Cookies("NameStorage") = "yes"			'Response.Cookies("NameStorage").path = "/cgi-bin"			'Response.Cookies("ubber2452553.0416") = Server.URLEncode(ObjRS("login") & "&#38;" & ObjRS("password") & "&#38;" & ObjRS("login") & "&#38;1000&#38;" & right("00000000" & ObjRS("userid"), 8) & "&#38;0&#38;0")		End If				Session("userid") = objRS("userid")		Session("userlevel") = objRS("userlevel")		Session("password") = objRS("password")		Session("login") = objRS("login")		Session("name") = objRS("firstname") & " " & objRS("lastname")		Session("firstname") = objRS("firstname")		Session("lastname") = objRS("lastname")		Session("bandidfav1") = objRS("bandidfav1")		Session("venueidfav1") = objRS("venueidfav1")		If objRS("password") = RANDOMPASSWORD or objRS("password") = CHANGEEMAILPASSWORD or objRS("password") = OLDRANDOMPASSWORD Then			objRS.Close			objDB.Close			%>				<script language = "javascript">				parent.Main.location='/shc/edituser.asp?userid=<%=Session("userid")%>';				parent.Top_Nav.location='/windyhop/header.asp?Tab=<%=Session("Tab")%>';							</script>			<%		Else			objRS.Close			objDB.Close			%>			<%		End If 'objRS("password") = RANDOMPASSWORD	End If	Response.Redirect(Request.Querystring("refpage"))End Sub''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub WelcomeUser()		'	Response.Write("WelcomeUser()<br>")		Response.Write ("Welcome, " & Session("firstname") & "!<br>")		Response.Write("<a href='/windyhop/login.asp?&logout=Y&submit=login&refpage=" & Request.ServerVariables("URL") & " class = login'>Want to logout?</a><br>")End Sub''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub CookieCheck()	'check cookie to database		'Response.Write("CookieCheck()<br>")	Dim objDB	Dim objRS	Dim strSQL		Set objDB = Server.CreateObject("ADODB.Connection")	objDB.Open DATABASE	Set objRS = Server.CreateObject("ADODB.Recordset")			strSQL = "SELECT login, password, userid, firstname, lastname, userlevel " _		       & " FROM   user " _			   & " WHERE  userid = " & Request.Cookies("userid")		'Response.Write(strSQL)		objRS.Open strSQL, DATABASE		If 	objRS.EOF = TRUE Then		Response.Write "Invalid user/password"	Else		'Response.Cookies("userid") = objRS("userid")		'Response.Cookies("userid").Expires = Date+365		Session("userid") = objRS("userid")				Session("userlevel") = objRS("userlevel")		Session("login") = objRS("login")		Session("password") = objRS("password")		Session("name") = objRS("firstname") & " " & objRS("lastname")		Session("firstname") = objRS("firstname")		Session("lastname") = objRS("lastname")				WelcomeUser()				objRS.Close		objDB.Close	End IfEnd Sub''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Sub BuildLoginForm()	'WriteForm	'	Response.Write("BuildLoginForm()<br>")	Dim localRefPage	localRefPage = Request.Querystring("refpage")	If Session("invalidlogin") = YES Then		Response.Write("<i>Invalid login/password</i><br>")	End If	If localRefPage = "" Then		%>						<form action=/windyhop/login.asp?tab=<%=Session("Tab")%>&submit=login&refpage=<%=Request.ServerVariables("URL")%> method=POST>				<% 	Else 'localRefPage != ""		%>		<form action=/windyhop/login.asp?tab=<%=Session("Tab")%>&submit=login&refpage=<%=localRefPage%>method=POST>		<%	End If ' if localRefPage = ""	%>		<!--Commented out by Matt	Login: <BR>	<INPUT type="text" id=login name=login size="10"><br>		Password: <BR>	<INPUT type="password" id=password name=password size="10"> <br>	<input type="checkbox" name="writecookie" value="Y" ><small>Remember me.	<a class=login href=javascript:popUp('whatsthis.asp?term=savelogin') alt=huh?><%=MOREINFO%></a>	<br>		<br>	<input type="submit" value="Submit">	Begin New Form -->		<!-- Login (user name) Field -->	<img src="/images/login.gif" border="0" width = 60 height = 30><BR>	<img src="/images/Blank.gif" border="0" width="12" height = 1>	<INPUT type = "text" id=login name=login size=10><BR>	<!-- Password Field -->	<img src="/images/Password.gif" border="0" width = 94 height = 30><BR>	<img src="/images/Blank.gif" border="0" width="12">	    <INPUT type = "password" id=password name=password size=10><BR>    <img src="/images/Blank.gif" border="0" height="8"><BR>	<!-- Remember My Password checkbox -->	<input type="checkbox" name="writecookie" value="Y" ><small>Remember me.</small><br> 	<img src="/images/Blank.gif" border="0" height="8"><BR>    <!-- Enter button -->	<INPUT TYPE=Image alt="Login" src="/images/Enter.gif" BORDER="0" width = 75 height = 30>	</form>	<%End Sub'''''''''''''''''''''''''''''''''''''''''''''''Sub LogUser()  Dim fso, f, s, NewFile, objLogFile  Set fso = CreateObject("Scripting.FileSystemObject")    Set objLogFile = fso.OpenTextFile("./jason.txt", 8)  objLogFile.WriteLine(Session("login") & " " & Date & " " & Time)  End Sub''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Function CheckLogin()If Request.QueryString("logout") = "Y" Then	Session("userlevel") = ""	Session("userid") = ""	Session("firstname") = ""	Session("lastname") = ""	Session("login") = ""	Session("name") = ""	Response.Cookies("userid") = ""	Response.Cookies("userid").Expires = Date+365	'Session.End	Response.Redirect(Request.Querystring("refpage"))	ElseIf Request.Form("login") <> "" then	LoginFormCheck()ElseIf Session("login") <> "" Then	WelcomeUser()ElseIf Request.Cookies("userid") <> "" Then	CookieCheck()ElseIf Request.ServerVariables("SCRIPT_NAME") = "/login.asp" Then	Else	BuildLoginForm()	End IfSession("invalidlogin") = NOEnd Function%>